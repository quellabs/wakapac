<!DOCTYPE html>
<html>
<head>
    <title>Debug Foreach</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        button { margin-right: 8px; }
        #side-effect-log { font-family: monospace; font-size: 0.9em; color: #555; margin-top: 8px; }
    </style>
</head>
<body>
<div id="app">
    <div class="test">
        <h3>Test 1: Direct array modification</h3>
        <button data-pac-bind="click: addItem">Add Item</button>
        <button data-pac-bind="click: removeItem">Remove Item</button>
        <p>Array length: {{items.length}}</p>
        <div data-pac-bind="foreach: items" data-pac-item="item">
            - {{item}}<br>
        </div>
    </div>

    <div class="test">
        <h3>Test 2: Watcher side effects (outside reactive system)</h3>
        <p>Count: {{count}}</p>
        <button data-pac-bind="click: increment">Increment</button>
        <button data-pac-bind="click: decrement">Decrement</button>
        <p>The watcher updates <code>document.title</code> and appends to a plain DOM element — neither goes through WakaPAC.</p>
        <div id="side-effect-log"></div>
    </div>
</div>

<script src="../wakapac.js"></script>
<script>
    const log = document.getElementById('side-effect-log');

    const app = wakaPAC('#app', {
        items: ['Initial item'],
        count: 0,

        watch: {
            count: function(newVal, oldVal) {
                // Side effect 1: update browser tab title
                document.title = `Count is ${newVal}`;

                // Side effect 2: append to a plain DOM element, not reactive state
                const line = document.createElement('div');
                line.textContent = `[${new Date().toLocaleTimeString()}] count changed: ${oldVal} → ${newVal}`;
                log.prepend(line);
            }
        },

        addItem() {
            this.items.push('New item ' + Date.now());
        },

        removeItem() {
            if (this.items.length > 1) {
                this.items.pop();
            }
        },

        increment() {
            this.count++;
        },

        decrement() {
            this.count--;
        }
    });
</script>
</body>
</html>