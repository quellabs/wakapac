!function(){"use strict";const t={PROXY:"undefined"!=typeof Proxy,isReactive:t=>t&&"object"==typeof t&&!t.nodeType&&!(t instanceof Date)&&!(t instanceof RegExp)&&!(t instanceof File),deepEq:(e,i)=>{if(e===i)return!0;if(!e||!i||typeof e!=typeof i||"object"!=typeof e)return!1;const r=Object.keys(e),n=Object.keys(i);return r.length===n.length&&r.every((r=>n.includes(r)&&t.deepEq(e[r],i[r])))},id:()=>Date.now()+"_"+(1e4*Math.random()|0),isEvent:t=>/^(click|submit|change|input|focus|blur|key(up|down))$/.test(t)};function e(){this.units=new Map,this.cache=new WeakMap}function i(e,r,n=""){return t.isReactive(e)?t.PROXY?function(e,r,n){Object.keys(e).forEach((a=>{e.hasOwnProperty(a)&&t.isReactive(e[a])&&(e[a]=i(e[a],r,n?`${n}.${a}`:a))}));const a=Array.isArray(e),s={};a&&["push","pop","shift","unshift","splice","sort","reverse"].forEach((t=>{s[t]=e[t]}));return new Proxy(e,{get:(e,o)=>a&&s[o]?function(...a){const c=s[o].apply(e,a);return/^(push|unshift|splice)$/.test(o)&&e.forEach(((a,s)=>{t.isReactive(a)&&!a._reactive&&(e[s]=i(a,r,`${n}.${s}`))})),r(n||"root",e,"array-mutation",{method:o,args:a}),c}:e[o],set(e,a,s){const o=e[a];return t.isReactive(s)&&(s=i(s,r,n?`${n}.${a}`:a)),e[a]=s,t.deepEq(o,s)||r(n?`${n}.${a}`:a,s,"set",{old:o}),!0},deleteProperty(t,e){const i=t[e];return delete t[e],r(n?`${n}.${e}`:e,void 0,"delete",{old:i}),!0}})}(e,r,n):function(e,r,n){Array.isArray(e)&&["push","pop","shift","unshift","splice","sort","reverse"].forEach((t=>{const i=e[t];Object.defineProperty(e,t,{value:function(...e){const a=i.apply(this,e);return r(n||"root",this,"array-mutation",{method:t,args:e}),a},enumerable:!1,configurable:!0})}));return Object.keys(e).forEach((a=>{e.hasOwnProperty(a)&&t.isReactive(e[a])&&(e[a]=i(e[a],r,n?`${n}.${a}`:a))})),Object.defineProperty(e,"_reactive",{value:!0,enumerable:!1}),e}(e,r,n):e}function r(e,r={},n={}){const a=document.querySelector(e);if(!a)throw new Error(`Container not found: ${e}`);const s=Object.assign({updateMode:"immediate",delay:300,deepReactivity:!0},n),o={bindings:new Map,abstraction:null,delays:new Map,parent:null,children:new Set,listeners:new Map,pending:null,pendingVals:null,orig:r,computedCache:new Map,computedDeps:new Map,propDeps:new Map,container:a,config:s,createBinding(t,e,i){const r={type:t,element:e,...i};return i.target&&(r.property=i.target.split(".")[0],r.propertyPath=i.target),r},updateBinding(t,e,i){const r=t.property===e||t.propertyPath&&t.propertyPath.startsWith(e+".");if(!r&&"foreach"!==t.type)return;const n={text:()=>this.updateText(t,e,i),attribute:()=>this.updateAttribute(t,e,i),input:()=>this.updateInput(t,e,i),checked:()=>this.updateChecked(t,e,i),visible:()=>this.updateVisible(t,i),foreach:()=>this.updateForeach(t,e,i)}[t.type];n&&(r||"foreach"===t.type)&&n.call(this)},updateForeach(t,e,i){if(t.collection!==e)return;const r=Array.isArray(i)?i:[],n=t.prev||[];this.arrEq(n,r)?t.prev=[...r]:(t.prev=[...r],t.element.innerHTML="",r.forEach(((e,i)=>{const r=this.renderItem(t.template,e,i,t.itemName,t.indexName);t.element.appendChild(r)})))},renderItem(t,e,i,r,n){const a=document.createElement("div");a.innerHTML=t;const s=a.firstElementChild||a.firstChild;if(!s)return document.createTextNode("");const o=s.cloneNode(!0);return this.processTemplate(o,e,i,r,n),o},processTemplate(t,e,i,r,n){const a=document.createTreeWalker(t,NodeFilter.SHOW_TEXT),s=[];let o;for(;o=a.nextNode();)s.push(o);s.forEach((t=>{let a=t.textContent;a=a.replace(new RegExp(`\\{\\{\\s*${r}\\.(\\w+)\\s*\\}\\}`,"g"),((t,i)=>e&&e.hasOwnProperty(i)?e[i]:"")),a=a.replace(new RegExp(`\\{\\{\\s*${r}\\s*\\}\\}`,"g"),(()=>"object"==typeof e?JSON.stringify(e):e||"")),a=a.replace(new RegExp(`\\{\\{\\s*${n}\\s*\\}\\}`,"g"),(()=>i)),t.textContent=a})),[t,...t.querySelectorAll("[data-pac-bind]")].forEach((t=>{const a=t.getAttribute("data-pac-bind");a&&a.split(",").forEach((a=>{const[s,o]=a.trim().split(":").map((t=>t.trim()));this.processBinding(t,s,o,e,i,r,n)}))}))},processBinding(e,i,r,n,a,s,o){const c={class:()=>{if(this.evalExpr(r,n,a,s,o)){const t=r.includes(".")?r.split(".").pop():r;e.classList.add(t)}},checked:()=>{e.checked=!!this.evalExpr(r,n,a,s,o)}};if(c[i])c[i]();else if(t.isEvent(i))e.addEventListener(i,(t=>{"function"==typeof this.abstraction[r]&&this.abstraction[r].call(this.abstraction,n,a,t)}));else{const t=this.evalExpr(r,n,a,s,o);null!=t&&e.setAttribute(i,t)}},evalExpr:(t,e,i,r,n)=>t===n?i:t===r?e:t.startsWith(`${r}.`)?t.substring(r.length+1).split(".").reduce(((t,e)=>t&&t.hasOwnProperty(e)?t[e]:void 0),e):t,arrEq:(e,i)=>e.length===i.length&&e.every(((e,r)=>t.deepEq(e,i[r]))),handleDeepChange(t,e,i,r){const n=t.split(".")[0];this.updateComputed(n),("array-mutation"===i||this.abstraction.hasOwnProperty(n))&&this.updateDOM(n,this.abstraction[n]),this.notifyParent("propertyChange",{property:n,path:t,newValue:e,changeType:i,meta:r})},updateDOM(t,e){this.pending||(this.pending=new Set,this.pendingVals={},(window.requestAnimationFrame||(t=>setTimeout(t,0)))((()=>this.flushDOM()))),this.pending.add(t),this.pendingVals[t]=e},flushDOM(){this.pending&&(this.pending.forEach((t=>{const e=this.pendingVals[t];this.bindings.forEach((i=>this.updateBinding(i,t,e)))})),this.pending=null,this.pendingVals=null)},updateText(t,e,i){if(t.property!==e)return;const r=this.resolvePropertyPath(t.propertyPath||t.property),n=this.formatDisplayValue(r),a=new RegExp(`\\{\\{\\s*${(t.propertyPath||t.property).replace(/\./g,"\\.")}\\s*\\}\\}`,"g");(t.textNode||t.element).textContent=t.origText.replace(a,n)},updateAttribute(t,e,i){const r=t.propertyPath&&t.propertyPath!==t.property?this.resolvePropertyPath(t.propertyPath):i;null!=r?t.element.setAttribute(t.attribute,r):t.element.removeAttribute(t.attribute)},updateInput(t,e,i){t.property===e&&t.element.value!==i&&(t.element.value=i)},updateChecked(t,e,i){t.property===e&&t.element.checked!==!!i&&(t.element.checked=!!i)},updateVisible(t,e){const i=t.propertyPath&&t.propertyPath!==t.property?this.resolvePropertyPath(t.propertyPath):e,r=t.isNegated?!i:!!i;this.toggleElementVisibility(t.element,r)},formatDisplayValue:t=>"object"==typeof t&&null!==t?Array.isArray(t)?`[${t.length} items]`:JSON.stringify(t,null,2):null==t?"":t,toggleElementVisibility(t,e){if(e)t.hasAttribute("data-pac-hidden")&&(t.style.display=t.getAttribute("data-pac-orig-display")||"",t.removeAttribute("data-pac-hidden"),t.removeAttribute("data-pac-orig-display"));else if(!t.hasAttribute("data-pac-hidden")){const e=getComputedStyle(t).display;"none"!==e&&t.setAttribute("data-pac-orig-display",e),t.style.display="none",t.setAttribute("data-pac-hidden","true")}},resolvePropertyPath(t){return t.split(".").reduce(((t,e)=>null==t?void 0:t[e]),this.abstraction)},analyzeComputed(t){if(!t||"function"!=typeof t)return[];try{const e=[],i=/this\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g;let r;for(;r=i.exec(t.toString());){const t=r[1];!this.orig.hasOwnProperty(t)||this.orig.computed&&this.orig.computed.hasOwnProperty(t)||e.includes(t)||e.push(t)}return e}catch(t){return console.error("Error analyzing computed function:",t),[]}},updateComputed(e){(this.propDeps.get(e)||[]).forEach((e=>{const i=this.computedCache.get(e);if(!this.orig.computed)return;const r=this.orig.computed[e];if(r&&"function"==typeof r)try{const n=r.call(this.abstraction);!Array.from(this.bindings.values()).some((t=>"foreach"===t.type&&t.collection===e))&&t.deepEq(i,n)||(this.computedCache.set(e,n),this.updateDOM(e,n),this.notifyParent("propertyChange",{property:e,oldValue:i,newValue:n,computed:!0}),this.updateComputed(e))}catch(t){console.error(`Error executing computed property '${e}':`,t)}}))},createReactiveAbs(){const t={};return this.setupComputedProperties(t),Object.keys(this.orig).forEach((e=>{if(this.orig.hasOwnProperty(e)&&"computed"!==e){const i=this.orig[e];"function"==typeof i?t[e]=i.bind(t):this.createReactiveProp(t,e,i)}})),Object.assign(t,{notifyParent:(t,e)=>this.notifyParent(t,e),sendToChildren:(t,e)=>this.sendToChildren(t,e),findChild:t=>Array.from(this.children).find(t)}),t},setupComputedProperties(t){this.orig.computed&&Object.keys(this.orig.computed).forEach((e=>{const i=this.orig.computed[e];if("function"==typeof i)try{const r=this.analyzeComputed(i);this.computedDeps.set(e,r),r.forEach((t=>{this.propDeps.has(t)||this.propDeps.set(t,[]);const i=this.propDeps.get(t);i.includes(e)||i.push(e)})),Object.defineProperty(t,e,{get:()=>{if(this.computedCache.has(e))return this.computedCache.get(e);try{const r=i.call(t);return this.computedCache.set(e,r),r}catch(t){return void console.error(`Error computing property '${e}':`,t)}},enumerable:!0})}catch(t){console.error(`Error setting up computed property '${e}':`,t)}}))},createReactiveProp(e,r,n){let a=n;this.config.deepReactivity&&t.isReactive(a)&&(a=i(a,((t,e,i,r)=>this.handleDeepChange(t,e,i,r)),r)),Object.defineProperty(e,r,{get:()=>a,set:e=>{if(t.isReactive(a)||t.isReactive(e)||!t.deepEq(a,e)){const n=a;this.config.deepReactivity&&t.isReactive(e)&&(e=i(e,((t,e,i,r)=>this.handleDeepChange(t,e,i,r)),r)),a=e,this.updateDOM(r,e),this.updateComputed(r),this.notifyParent("propertyChange",{property:r,oldValue:n,newValue:e})}},enumerable:!0})},setupBindings(){this.findTextBindings(),this.findAttrBindings()},findTextBindings(){const e=document.createTreeWalker(this.container,NodeFilter.SHOW_TEXT),i=[];let r;for(;r=e.nextNode();){const e=r.textContent,n=e.match(/\{\{\s*([\w.]+)\s*\}\}/g);n&&n.forEach((n=>{const a=n.replace(/[{}\s]/g,""),s=a.split(".")[0];i.push([t.id(),{type:"text",property:s,propertyPath:a,element:r.parentElement,origText:e,textNode:r}])}))}i.forEach((([t,e])=>this.bindings.set(t,e)))},findAttrBindings(){const e=this.container.querySelectorAll('[data-pac-bind]:not([data-pac-bind*="foreach"] [data-pac-bind])'),i=[];Array.from(e).forEach((e=>{e.getAttribute("data-pac-bind").split(",").forEach((r=>{const[n,a]=r.trim().split(":").map((t=>t.trim())),s=r+"_"+t.id(),o={foreach:()=>this.createForeachBinding(e,a),visible:()=>this.createVisibilityBinding(e,a),value:()=>(this.setupInput(e,a),this.createInputBinding(e,a)),checked:()=>(this.setupInput(e,a,"checked"),this.createCheckedBinding(e,a))};o[n]?(i.push([s,o[n]()]),"foreach"===n&&(e.innerHTML="")):t.isEvent(n)?i.push([s,this.createEventBinding(e,n,a)]):r.includes(":")&&a?i.push([s,this.createAttributeBinding(e,n,a)]):r.includes(":")||console.error(`Invalid binding syntax: "${r}". Use "type:target" format.`)}))})),i.forEach((([t,e])=>this.bindings.set(t,e)))},createForeachBinding(t,e){return this.createBinding("foreach",t,{target:e,collection:e,itemName:t.getAttribute("data-pac-item")||"item",indexName:t.getAttribute("data-pac-index")||"index",template:t.innerHTML})},createEventBinding(t,e,i){return this.createBinding("event",t,{event:e,method:i})},createVisibilityBinding(t,e){const i=e.startsWith("!"),r=e.replace(/^!/,"");return this.createBinding("visible",t,{target:r,condition:e,isNegated:i})},createAttributeBinding(t,e,i){return this.createBinding("attribute",t,{target:i,attribute:e})},createInputBinding(t,e){return this.createBinding("input",t,{target:e,updateMode:t.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(t.getAttribute("data-pac-update-delay"))||this.config.delay})},createCheckedBinding(t,e){return this.createBinding("checked",t,{target:e,updateMode:t.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(t.getAttribute("data-pac-update-delay"))||this.config.delay})},setupInput(t,e,i="value"){t.setAttribute("data-pac-property",e),t.setAttribute("data-pac-binding-type",i),t.setAttribute("data-pac-update-mode",t.getAttribute("data-pac-update")||this.config.updateMode),t.setAttribute("data-pac-update-delay",t.getAttribute("data-pac-delay")||this.config.delay)},setupEvents(){["input","change","click","submit","focus","blur","keyup","keydown"].forEach((t=>{const e=t=>this.handleEvent(t);this.container.addEventListener(t,e),this.listeners.set(t,e)}))},handleEvent(t){const{type:e,target:i}=t,r=i.getAttribute("data-pac-property"),n={input:()=>r&&this.abstraction.hasOwnProperty(r)&&this._handleInputEvent(t,i,r),change:()=>r&&this.abstraction.hasOwnProperty(r)&&this._handleChangeEvent(t,i,r),default:()=>this._handleEventBinding(t,e,i)};(n[e]||n.default)()},_handleInputEvent(t,e,i){const r=e.getAttribute("data-pac-update-mode")||this.config.updateMode,n="checked"===(e.getAttribute("data-pac-binding-type")||"value")?e.checked:e.value,a={change:()=>e.setAttribute("data-pac-pending-value",n),immediate:()=>this.abstraction[i]=n,delayed:()=>this.updateFromDOM(e,i,n),default:()=>{console.warn(`Unknown update mode: ${r}. Using immediate.`),this.abstraction[i]=n}};(a[r]||a.default)()},_handleChangeEvent(t,e,i){const r=`${i}_${e.getAttribute("data-pac-property")}`,n=e.getAttribute("data-pac-binding-type")||"value";this.delays.has(r)&&(clearTimeout(this.delays.get(r)),this.delays.delete(r)),this.abstraction[i]="checked"===n?e.checked:e.value,e.removeAttribute("data-pac-pending-value")},_handleEventBinding(t,e,i){this.bindings.forEach((r=>{if("event"===r.type&&r.event===e&&r.element===i){const e=this.abstraction[r.method];if("function"!=typeof e)return void console.warn(`Event handler method '${r.method}' is not a function`);"submit"===r.event&&t.preventDefault();try{e.call(this.abstraction,t)}catch(t){console.error(`Error executing event handler '${r.method}':`,t)}}}))},updateFromDOM(t,e,i){const r=t.getAttribute("data-pac-update-mode")||this.config.updateMode,n=parseInt(t.getAttribute("data-pac-update-delay"))||this.config.delay;if("immediate"!==r){if("delayed"===r){const r=`${e}_${t.id||t.getAttribute("data-pac-property")}`;this.delays.has(r)&&clearTimeout(this.delays.get(r));const a=setTimeout((()=>{this.abstraction[e]=i,this.delays.delete(r)}),n);this.delays.set(r,a)}}else this.abstraction[e]=i},establishHierarchy(){const{parent:t,children:e}=window.PACRegistry.getHierarchy(this.container);t&&this.parent!==t&&(this.parent=t,t.children.add(this)),e.forEach((t=>{t.parent!==this&&(t.parent&&t.parent.children.delete(t),t.parent=this,this.children.add(t))}))},notifyParent(t,e){this.parent&&"function"==typeof this.parent.receiveUpdate&&this.parent.receiveUpdate(t,e,this)},receiveUpdate(t,e,i){this.abstraction.onChildUpdate&&this.abstraction.onChildUpdate(t,e,i),this.container.dispatchEvent(new CustomEvent("pac:childupdate",{detail:{eventType:t,data:e,childPAC:i},bubbles:!0}))},receiveFromParent(t,e){this.abstraction.receiveFromParent&&this.abstraction.receiveFromParent(t,e),this.container.dispatchEvent(new CustomEvent("pac:parentcommand",{detail:{command:t,data:e},bubbles:!0}))},sendToChildren(t,e){this.children.forEach((i=>{"function"==typeof i.receiveFromParent&&i.receiveFromParent(t,e)}))},initialUpdate(){Object.keys(this.abstraction).forEach((t=>{this.abstraction.hasOwnProperty(t)&&"function"!=typeof this.abstraction[t]&&this.updateDOM(t,this.abstraction[t])})),this.orig.computed&&Object.keys(this.orig.computed).forEach((t=>{this.updateDOM(t,this.abstraction[t])})),this.bindings.forEach((t=>{if("foreach"===t.type){t.prev=[];const e=this.abstraction[t.collection];void 0!==e&&this.updateForeach(t,t.collection,e)}}))},destroy(){this.listeners.forEach(((t,e)=>{this.container.removeEventListener(e,t)})),this.delays.forEach((t=>clearTimeout(t))),this.parent&&this.parent.children.delete(this),this.children.forEach((t=>t.parent=null)),[this.computedCache,this.computedDeps,this.propDeps,this.bindings].forEach((t=>t.clear())),this.abstraction=null},init(){return this.setupBindings(),this.trackPropertyPathDependencies(),this.abstraction=this.createReactiveAbs(),this.setupEvents(),this.initialUpdate(),this},trackPropertyPathDependencies(){this.bindings.forEach((t=>{if("text"===t.type&&t.propertyPath){const e=t.propertyPath.split(".");for(let i=0;i<e.length;i++){const i=e[0];this.propDeps.has(i)||this.propDeps.set(i,[]);const r=this.propDeps.get(i);r.includes(t)||r.push(t)}}}))}};const c=function(t,e){const i={};return Object.keys(t.abstraction).forEach((e=>{t.abstraction.hasOwnProperty(e)&&(i[e]=t.abstraction[e])})),Object.assign(i,{addChild:t=>{e.children.add(t),t.parent=e},removeChild:t=>{e.children.delete(t),t.parent=null},notifyParent:(t,i)=>e.notifyParent(t,i),receiveUpdate:(t,i,r)=>e.receiveUpdate(t,i,r),receiveFromParent:(t,i)=>e.receiveFromParent(t,i),sendToChildren:(t,i)=>e.sendToChildren(t,i),sendToChild:(t,i,r)=>{const n=Array.from(e.children).find((e=>e.container.matches(t)));n&&n.receiveFromParent&&n.receiveFromParent(i,r)},findChild:t=>Array.from(e.children).find(t),findChildren:t=>Array.from(e.children).filter(t),findChildBySelector:t=>Array.from(e.children).find((e=>e.container.matches(t))),findChildByProperty:(t,i)=>Array.from(e.children).find((e=>e.abstraction&&e.abstraction[t]===i)),control:(t,i={})=>fetch(t,{method:i.method||"GET",headers:Object.assign({"Content-Type":"application/json","X-PAC-Request":"true"},i.headers||{}),body:i.data?JSON.stringify(i.data):void 0}).then((t=>t.json())).then((t=>(i.updateProperties&&Object.keys(t).forEach((i=>{e.abstraction.hasOwnProperty(i)&&(e.abstraction[i]=t[i])})),i.onSuccess&&i.onSuccess.call(e.abstraction,t),t))).catch((t=>{throw i.onError&&i.onError.call(e.abstraction,t),t})),destroy:()=>e.destroy()}),Object.defineProperties(i,{parent:{get:()=>e.parent,enumerable:!0},children:{get:()=>Array.from(e.children),enumerable:!0},container:{get:()=>e.container,enumerable:!0}}),i}(o.init(),o);return window.PACRegistry.register(e,o),o.establishHierarchy(),window.PACRegistry.units.forEach((t=>{t===o||t.parent||t.establishHierarchy()})),c}e.prototype={register(t,e){this.units.set(t,e),this.cache=new WeakMap},unregister(t){const e=this.units.get(t);return e&&(this.units.delete(t),this.cache=new WeakMap),e},getHierarchy(t){if(this.cache.has(t))return this.cache.get(t);let e=null,i=t.parentElement;const r=[];for(;i&&!e;)this.units.forEach((t=>{t.container===i&&(e=t)})),i=i.parentElement;this.units.forEach((e=>{t.contains(e.container)&&e.container!==t&&r.push(e)}));const n={parent:e,children:r};return this.cache.set(t,n),n}},window.PACRegistry=window.PACRegistry||new e,window.wakaPAC=r,"undefined"!=typeof module&&module.exports&&(module.exports={wakaPAC:r,PACRegistry:e,ReactiveUtils:t})}();