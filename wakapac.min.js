!function(){"use strict";const e={tokens:[],currentToken:0,OPERATOR_PRECEDENCE:{"||":1,"&&":2,"===":6,"!==":6,"==":6,"!=":6,"<":7,">":7,"<=":7,">=":7,"+":8,"-":8,"*":9,"/":9,"%":9,"!":10,"unary-":10,"unary+":10},OPERATOR_TYPES:{"||":"logical","&&":"logical","===":"comparison","!==":"comparison","==":"comparison","!=":"comparison",">=":"comparison","<=":"comparison",">":"comparison","<":"comparison","+":"arithmetic","-":"arithmetic","*":"arithmetic","/":"arithmetic","%":"arithmetic"},parseExpression(e){if("object"==typeof e&&null!==e){if(e.dependencies)return e;const t=this.extractDependencies(e);return Object.assign({},e,{dependencies:t})}e=String(e).trim();try{if(this.tokens=this.tokenize(e),this.currentToken=0,0===this.tokens.length)return null;const t=this.parseTernary();return t&&(t.dependencies=this.extractDependencies(t)),t}catch(t){throw new Error(`Expression parsing failed: "${e}"\nOriginal error: ${t.message}`)}},tokenize(e){const t=[];let n=0;for(;n<e.length;){const i=e[n];if(/\s/.test(i)){n++;continue}if('"'===i||"'"===i){const i=this.tokenizeString(e,n);t.push(i.token),n=i.nextIndex;continue}if(/\d/.test(i)||"."===i&&/\d/.test(e[n+1])){const i=this.tokenizeNumber(e,n);t.push(i.token),n=i.nextIndex;continue}const r=/^(===|!==|==|!=|>=|<=|&&|\|\|)/.exec(e.slice(n));if(r){const e=r[1];t.push({type:"OPERATOR",value:e,precedence:this.getOperatorPrecedence(e)}),n+=e.length;continue}const s={"(":"LPAREN",")":"RPAREN","{":"LBRACE","}":"RBRACE","[":"LBRACKET","]":"RBRACKET",",":"COMMA",".":"DOT"};if(s[i])t.push({type:s[i],value:i}),n++;else{if("+-*/<>!?:%".includes(i)){const e=this.getOperatorPrecedence(i);let r="?"===i?"QUESTION":":"===i?"COLON":"OPERATOR";t.push({type:r,value:i,precedence:e}),n++;continue}if(/[a-zA-Z_$]/.test(i)){const i=this.tokenizeIdentifier(e,n);t.push(i.token),n=i.nextIndex;continue}n++}}return t},tokenizeString(e,t){const n=e[t];let i=t+1,r="";for(;i<e.length;){const t=e[i];if("\\"===t&&i+1<e.length){const s=e[i+1];s===n||"\\"===s?(r+=s,i+=2):(r+=t,i++)}else{if(t===n)return{token:{type:"STRING",value:r},nextIndex:i+1};r+=t,i++}}throw new Error(`Unterminated string literal starting at position ${t}`)},tokenizeNumber(e,t){const n=/^(\d*\.?\d+(?:[eE][+-]?\d+)?)/.exec(e.slice(t));if(n)return{token:{type:"NUMBER",value:parseFloat(n[1])},nextIndex:t+n[1].length}},tokenizeIdentifier(e,t){const n=/^([a-zA-Z_$][a-zA-Z0-9_$]*)/.exec(e.slice(t));if(n){const e=n[1];return{token:{type:["true","false","null","undefined"].includes(e)?"KEYWORD":"IDENTIFIER",value:e},nextIndex:t+e.length}}},getOperatorPrecedence(e){return this.OPERATOR_PRECEDENCE[e]||0},parseTernary(){let e=this.parseBinaryWithPrecedence(1);if(this.match("QUESTION")){const t=this.parseTernary();return this.consume("COLON",'Expected ":" in ternary expression'),{type:"ternary",condition:e,trueValue:t,falseValue:this.parseTernary()}}return e},parseBinaryWithPrecedence(e){let t=this.parseUnary();for(;"OPERATOR"===this.peek().type;){const n=this.getOperatorPrecedence(this.peek().value);if(n<e)break;const i=this.advance().value,r=this.parseBinaryWithPrecedence(n+1);t={type:this.OPERATOR_TYPES[i]||"arithmetic",left:t,operator:i,right:r}}return t},parseUnary(){return this.matchOperator("!","-","+")?{type:"unary",operator:this.previous().value,operand:this.parseUnary()}:this.parsePrimary()},parsePrimary(){if(this.match("LPAREN")){const e=this.parseTernary();return this.consume("RPAREN","Expected closing parenthesis"),{type:"parentheses",inner:e}}return this.match("LBRACE")?this.parseObjectLiteral():this.check("STRING")||this.check("NUMBER")?{type:"literal",value:this.advance().value}:this.check("KEYWORD")?{type:"literal",value:{true:!0,false:!1,null:null,undefined:void 0}[this.advance().value]}:this.check("IDENTIFIER")?this.parsePropertyAccess():null},parseObjectLiteral(){const e=[];if(!this.check("RBRACE"))do{let t;if(this.check("STRING"))t=this.advance().value;else{if(!this.check("IDENTIFIER"))throw new Error("Expected property name");t=this.advance().value}this.consume("COLON",'Expected ":" after object key');const n=this.parseTernary();e.push({key:t,value:n})}while(this.match("COMMA")&&!this.check("RBRACE"));return this.consume("RBRACE","Expected closing brace"),{type:"object",pairs:e}},parsePropertyAccess(){let e=this.advance().value;for(;;)if(this.match("DOT")){if(!this.check("IDENTIFIER"))throw new Error('Expected property name after "."');e+="."+this.advance().value}else{if(!this.match("LBRACKET"))break;{const t=this.parseTernary();this.consume("RBRACKET","Expected closing bracket"),"literal"===t.type?e+="["+JSON.stringify(t.value)+"]":e+="["+this.reconstructExpression(t)+"]"}}return{type:"property",path:e}},reconstructExpression(e){if(!e)return"";switch(e.type){case"literal":return"string"==typeof e.value?'"'+e.value+'"':String(e.value);case"property":return e.path;case"arithmetic":return`${this.reconstructExpression(e.left)} ${e.operator} ${this.reconstructExpression(e.right)}`;default:return"unknown"}},match(...e){for(const t of e)if(this.check(t))return this.advance(),!0;return!1},matchOperator(...e){if(this.check("OPERATOR")){const t=this.peek();if(e.includes(t.value))return this.advance(),!0}return!1},check(e){return!this.isAtEnd()&&this.peek().type===e},advance(){return this.isAtEnd()||this.currentToken++,this.previous()},isAtEnd(){return this.currentToken>=this.tokens.length},peek(){return this.tokens[this.currentToken]||{type:"EOF",value:null}},previous(){return this.tokens[this.currentToken-1]},consume(e,t){if(this.check(e))return this.advance();throw new Error(t+` at token: ${JSON.stringify(this.peek())}`)},evaluate(e,t){if(e)switch(e.type){case"literal":return e.value;case"property":return this.getProperty(t,e.path);case"parentheses":return this.evaluate(e.inner,t);case"object":return this.evaluateObjectLiteral(e,t);case"ternary":return this.evaluate(e.condition,t)?this.evaluate(e.trueValue,t):this.evaluate(e.falseValue,t);case"logical":{const n=this.evaluate(e.left,t);return"&&"===e.operator?!!n&&this.evaluate(e.right,t):"||"===e.operator&&(!!n||this.evaluate(e.right,t))}case"comparison":case"arithmetic":{const n=this.evaluate(e.left,t),i=this.evaluate(e.right,t);return this.performOperation(n,e.operator,i)}case"unary":{const n=this.evaluate(e.operand,t);switch(e.operator){case"!":return!n;case"-":return-n;case"+":return+n;default:return n}}default:return}},getProperty(e,t){if(!e||!t)return;if(-1===t.indexOf("."))return e[t];const n=t.split(".");let i=e;for(let e=0;e<n.length;e++){if(null==i)return;i=i[n[e]]}return i},evaluateObjectLiteral(e,t){const n={};return e.pairs&&e.pairs.forEach(({key:e,value:i})=>{n[e]=this.evaluate(i,t)}),n},performOperation(e,t,n){switch(t){case"+":return e+n;case"-":return Number(e)-Number(n);case"*":return Number(e)*Number(n);case"/":return Number(e)/Number(n);case"%":return Number(e)%Number(n);case"===":return e===n;case"!==":return e!==n;case"==":return e==n;case"!=":return e!=n;case">=":return e>=n;case"<=":return e<=n;case">":return e>n;case"<":return e<n;default:return!1}},extractDependencies(e){if(!e)return[];const t=new Set,n=e=>{if(e)switch(e.type){case"property":{const n=e.path.split(/[.[]/,1)[0];n&&!["true","false","null","undefined"].includes(n)&&t.add(n);break}case"ternary":n(e.condition),n(e.trueValue),n(e.falseValue);break;case"logical":case"comparison":case"arithmetic":n(e.left),n(e.right);break;case"unary":n(e.operand);break;case"parentheses":n(e.inner);break;case"object":e.pairs&&e.pairs.forEach(e=>n(e.value))}};return n(e),Array.from(t)},parseBindingString(e){const t=[];let n="",i=!1,r="",s=0,a=0;for(let o=0;o<e.length;o++){const c=e[o],p=o>0&&"\\"===e[o-1];'"'!==c&&"'"!==c||p||(i?c===r&&(i=!1,r=""):(i=!0,r=c)),i||("("===c?s++:")"===c?s--:"{"===c?a++:"}"===c&&a--),","!==c||i||0!==s||0!==a?n+=c:(this.addBindingPairIfValid(n,t),n="")}return this.addBindingPairIfValid(n,t),t},addBindingPairIfValid(e,t){const n=e.trim();if(!n)return;const i=this.findBindingColon(n);-1===i?t.push({type:n,target:""}):t.push({type:n.substring(0,i).trim(),target:n.substring(i+1).trim()})},findBindingColon(e){const t=["value","checked","visible","if","foreach","class","style","click","change","input","submit","focus","blur","keyup","keydown"];for(const n of t)if(e.startsWith(n+":"))return n.length;let n=!1,i="",r=0;for(let t=0;t<e.length;t++){const s=e[t],a=t>0&&"\\"===e[t-1];if('"'!==s&&"'"!==s||a||(n?s===i&&(n=!1,i=""):(n=!0,i=s)),!n)if("("===s)r++;else if(")"===s)r--;else if(":"===s&&0===r)return t}return-1}},t={cache:new Map,maxSize:500,parseExpression(t){const n=String(t).trim();if(this.cache.has(n)){const e=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,e),e}const i=e.parseExpression(t);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}return this.cache.set(n,i),i}};function n(e,t){const n=["push","pop","shift","unshift","splice","sort","reverse"];return e&&"object"==typeof e?function e(i,r){return r=r||[],new Proxy(i,{get:function(i,s){const a=i[s];if(Array.isArray(i)&&"function"==typeof a&&n.includes(s))return function(){if("push"===s||"unshift"===s)for(let t=0;t<arguments.length;t++)arguments[t]&&"object"==typeof arguments[t]&&!arguments[t]._isReactive&&(arguments[t]=e(arguments[t],r.concat([i.length+t])),arguments[t]._isReactive=!0);else if("splice"===s&&arguments.length>2)for(let t=2;t<arguments.length;t++)arguments[t]&&"object"==typeof arguments[t]&&!arguments[t]._isReactive&&(arguments[t]=e(arguments[t],r.concat([arguments[0]+t-2])),arguments[t]._isReactive=!0);const n=Array.prototype.slice.call(i),a=Array.prototype[s].apply(i,arguments),o=Array.prototype.slice.call(i);return t.dispatchEvent(new CustomEvent("pac:array-change",{detail:{path:r,oldValue:n,newValue:o,method:s}})),a};if(a&&"object"==typeof a&&!a._isReactive){const t=r.concat([s]);i[s]=e(a,t),i[s]._isReactive=!0}return i[s]},set:function(n,i,s){const a=n[i],o=r.concat([i]);return a===s||(s&&"object"==typeof s?(n[i]=e(s,o),n[i]._isReactive=!0):n[i]=s,Array.isArray(s)&&t.dispatchEvent(new CustomEvent("pac:array-change",{detail:{path:o,oldValue:a,newValue:n[i],method:"assignment"}})),t.dispatchEvent(new CustomEvent("pac:change",{detail:{path:o,oldValue:a,newValue:n[i]}}))),!0}})}(e,[]):e}function i(e,t){const n=new Map,i=new Map;Object.keys(t).forEach(r=>{const s=t[r],a=function(e){const t=e.toString().match(/this\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g)||[];return[...new Set(t.map(e=>e.replace("this.","")))]}(s);i.set(r,{fn:s,dependencies:a,isDirty:!0}),Object.defineProperty(e,r,{get(){const e=i.get(r);if(e.isDirty||!n.has(r)){const t=e.fn.call(this);n.set(r,t),e.isDirty=!1}return n.get(r)},enumerable:!0})}),this.invalidateComputed=function(e){const t=[];return i.forEach((i,r)=>{i.dependencies.includes(e)&&(i.isDirty=!0,n.delete(r),t.push(r))}),t}}function r(e){this.container=e,this.propertyToElements=new Map,this.elementToBindings=new WeakMap,this.container.setAttribute("data-pac-container","")}function s(e,t){this.container=e,this.subscriptionMap=t,this.bindings=new Map,this.eventBindings=[],this.bindingCounter=0,this.textNodes=[],this.attributeElements=[],this.cacheElements()}function a(e,t,n){this.container=e,this.subscriptionMap=t,this.bindingManager=n,this.foreachBindings=new Map,this.itemReactivityCleanup=new WeakMap}r.prototype.subscribe=function(e,t,n){return!!this.belongsToThisContainer(e)&&(this.propertyToElements.has(t)||this.propertyToElements.set(t,new Set),this.propertyToElements.get(t).add(e),this.elementToBindings.has(e)||this.elementToBindings.set(e,new Set),this.elementToBindings.get(e).add(n),!0)},r.prototype.belongsToThisContainer=function(e){if(e._pacContainerCheck===this.container)return!0;if(e._pacContainerCheck)return!1;let t;if(e.nodeType===Node.TEXT_NODE){const n=e.parentElement;if(!n)return!1;t=n.closest("[data-pac-container]")===this.container}else t=e.closest("[data-pac-container]")===this.container;return e._pacContainerCheck=!!t&&this.container,t},r.prototype.getSubscribedElements=function(e){const t=this.propertyToElements.get(e)||new Set,n=new Set,i=this;return t.forEach(function(e){e.isConnected&&i.belongsToThisContainer(e)&&n.add(e)}),this.propertyToElements.set(e,n),n},r.prototype.getBindingForElementAndProperty=function(e,t){const n=this.elementToBindings.get(e)||new Set;for(const e of n)if(e.dependencies&&e.dependencies.includes(t))return e;return null},s.prototype.cacheElements=function(){const e=document.createTreeWalker(this.container,NodeFilter.SHOW_TEXT,{acceptNode:e=>/\{\{.*\}\}/.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});let t;for(;t=e.nextNode();)this.subscriptionMap.belongsToThisContainer(t)&&this.textNodes.push(t);const n=this.container.querySelectorAll("[data-pac-bind]");Array.from(n).forEach(e=>{this.subscriptionMap.belongsToThisContainer(e)&&this.attributeElements.push(e)})},s.prototype.batchDOMUpdates=function(e){this.pendingUpdates?this.pendingUpdates=this.pendingUpdates.concat(e):(this.pendingUpdates=e,requestAnimationFrame(()=>{const e=this.pendingUpdates;this.pendingUpdates=null,e.forEach(e=>{e()})}))},s.prototype.createBinding=function(e,t,n){const i={id:++this.bindingCounter+"_"+Date.now(),type:e,element:t,target:n.target,originalText:n.originalText,fullMatch:n.fullMatch,dependencies:n.dependencies||[]};return this.bindings.set(i.id,i),i},s.prototype.setupTextBindings=function(){const e=this;this.textNodes.forEach(function(n){const i=n.textContent,r=i.match(/\{\{\s*([^}]+)\s*}}/g);r&&r.forEach(function(r){const s=r.replace(/^\{\{\s*|\s*}}$/g,"").trim(),a=t.parseExpression(s).dependencies||[],o=e.createBinding("text",n,{target:s,originalText:i,fullMatch:r,dependencies:a});a.forEach(function(t){e.subscriptionMap.subscribe(n,t,o)})})})},s.prototype.setupAttributeBindings=function(n){const i=this;this.attributeElements.forEach(function(r){const s=r.getAttribute("data-pac-bind"),a=e.parseBindingString(s);if(a.forEach(function(e){const n=e.type,s=e.target;if(i.isEventBinding(n))i.eventBindings.push({element:r,type:n,target:s});else if(s){const e=t.parseExpression(s).dependencies||[],a=i.createBinding(n,r,{target:s,dependencies:e});a&&e.forEach(function(e){i.subscriptionMap.subscribe(r,e,a)}),"value"===n&&"value"in r&&i.setupTwoWayBinding(r,s),"checked"===n&&"checkbox"===r.type&&i.setupTwoWayBinding(r,s,"change")}}),n){const e=Object.keys(n);a.forEach(function(t){t.target&&e.forEach(function(e){if(t.target.includes(e)){const n=i.createBinding(t.type,r,{target:t.target,dependencies:[e]});i.subscriptionMap.subscribe(r,e,n)}})})}})},s.prototype.setupTwoWayBinding=function(e,t,n){n=n||"input";const i=this;e.addEventListener(n,function(){const n=i.container.id?"#"+i.container.id:i.container.className?"."+i.container.className.split(" ")[0]:null,r=window.PACRegistry.components.get(n);if(r&&r.abstraction){let n;n="checkbox"===e.type?e.checked:e.value,i.setNestedProperty(r.abstraction,t,n)}})},s.prototype.setNestedProperty=function(e,t,n){const i=t.split(".");let r=e;for(let e=0;e<i.length-1;e++)r[i[e]]||(r[i[e]]={}),r=r[i[e]];r[i[i.length-1]]=n},s.prototype.processElementBindings=function(e,t){this.processTextNodesWithContext(e,t),this.processAttributeBindingsWithContext(e,t)},s.prototype.processTextNodesWithContext=function(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/\{\{.*\}\}/.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),i=[];let r;for(;r=n.nextNode();)i.push(r);const s=this;i.forEach(function(e){const n=e.textContent,i=s.processTextInterpolation(n,t);e.textContent=i})},s.prototype.processAttributeBindingsWithContext=function(n,i){const r=n.querySelectorAll("[data-pac-bind]"),s=n.hasAttribute("data-pac-bind")?[n].concat(Array.from(r)):Array.from(r),a=this;s.forEach(function(n){const r=n.getAttribute("data-pac-bind");e.parseBindingString(r).forEach(function(r){if("foreach"!==r.type)if(a.isEventBinding(r.type)&&r.target)a.setupContextualEventBinding(n,r.type,r.target,i);else if(r.target){const s=t.parseExpression(r.target),o=e.evaluate(s,i);a.applyBindingWithType(n,r.type,o),"value"===r.type&&"value"in n&&a.setupContextualTwoWayBinding(n,r.target,i,"input"),"checked"===r.type&&"checkbox"===n.type&&a.setupContextualTwoWayBinding(n,r.target,i,"change")}})})},s.prototype.setupContextualTwoWayBinding=function(e,n,i,r){const s=this;e.addEventListener(r,function(){let r;r="checkbox"===e.type?e.checked:e.value;const a=t.parseExpression(n);s.setPropertyInContext(a,i,r)})},s.prototype.setPropertyInContext=function(e,t,n){if(!e||"property"!==e.type)return;const i=e.path.split(".");let r=t;for(let e=0;e<i.length-1;e++){if(!r||"object"!=typeof r)return;r=r[i[e]]}r&&"object"==typeof r&&(r[i[i.length-1]]=n)},s.prototype.setupContextualEventBinding=function(e,t,n,i){e.addEventListener(t,function(e){const t=i.__parent||i;if(t&&"function"==typeof t[n]){const r=t[n];try{void 0!==i.item&&void 0!==i.$index?r.call(t,i.item,i.$index,e):r.call(t,e)}catch(e){}}})},s.prototype.applyBindingWithType=function(e,t,n){switch(t){case"visible":this.applyVisibilityBinding({element:e},n);break;case"value":this.applyInputBinding({element:e},n);break;case"checked":this.applyCheckedBinding({element:e},n);break;default:this.applyAttributeBinding({element:e,type:t},n)}},s.prototype.isEventBinding=function(e){return["click","change","input","submit","focus","blur","keyup","keydown"].includes(e)},s.prototype.getTextNodesFromElement=function(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>/\{\{.*\}\}/.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});let i;for(;i=n.nextNode();)t.push(i);return t},s.prototype.updateElementForProperty=function(n,i,r){const s=this.subscriptionMap.getBindingForElementAndProperty(n,i);if(!s)return;const a=t.parseExpression(s.target),o=e.evaluate(a,r);switch(s.type){case"text":this.applyTextBinding(s,r);break;case"visible":this.applyVisibilityBinding(s,o);break;case"value":this.applyInputBinding(s,o);break;case"checked":this.applyCheckedBinding(s,o);break;default:this.applyAttributeBinding(s,o)}},s.prototype.processTextInterpolation=function(n,i){let r=String(n||"");const s=r.match(/\{\{\s*([^}]+)\s*}}/g);if(s)for(let n=0;n<s.length;n++){const a=s[n],o=a.replace(/^\{\{\s*|\s*}}$/g,"").trim();try{const n=t.parseExpression(o),s=e.evaluate(n,i),c=null!=s?String(s):"";r=r.replace(a,c)}catch(e){}}return r},s.prototype.applyTextBinding=function(e,t){const n=e.element,i=this.processTextInterpolation(e.originalText,t);n.textContent!==i&&(n.textContent=i)},s.prototype.applyVisibilityBinding=function(e,t){const n=e.element;if(t)n.hasAttribute("data-pac-hidden")&&(n.style.display=n.getAttribute("data-pac-orig-display")||"",n.removeAttribute("data-pac-hidden"),n.removeAttribute("data-pac-orig-display"));else if(!n.hasAttribute("data-pac-hidden")){const e=getComputedStyle(n).display;"none"!==e&&n.setAttribute("data-pac-orig-display",e),n.style.display="none",n.setAttribute("data-pac-hidden","true")}},s.prototype.applyInputBinding=function(e,t){const n=e.element,i=String(t||"");"value"in n&&n.value!==i&&(n.value=i)},s.prototype.applyCheckedBinding=function(e,t){e.element.checked=Boolean(t)},s.prototype.applyAttributeBinding=function(e,t){const n=e.element,i=e.type;["readonly","required","selected","checked","hidden","multiple"].includes(i)?n.toggleAttribute(i,!!t):null!=t?n.setAttribute(i,t):n.removeAttribute(i)},s.prototype.getEventBindings=function(){return this.eventBindings},s.prototype.getBinding=function(e){return this.bindings.get(e)},s.prototype.removeBinding=function(e){return this.bindings.delete(e)},s.prototype.cleanup=function(){this.bindings.clear(),this.eventBindings=[]},a.prototype.setupForeachBindings=function(){const t=this.container.querySelectorAll('[data-pac-bind*="foreach:"]'),n=this;Array.from(t).forEach(function(t){if(!n.subscriptionMap.belongsToThisContainer(t))return;const i=t.getAttribute("data-pac-bind"),r=e.parseBindingString(i).find(function(e){return"foreach"===e.type});if(r){const e=r.target,i={arrayProperty:e,itemName:t.getAttribute("data-pac-item")||"item",indexName:t.getAttribute("data-pac-index")||"$index",element:t};n.foreachBindings.set(t,i),n.subscriptionMap.subscribe(t,e,{type:"foreach",element:t,target:e,dependencies:[e]}),i.template=t.cloneNode(!0),i.template.removeAttribute("data-pac-bind"),i.template.removeAttribute("data-pac-item"),i.template.removeAttribute("data-pac-index"),t.innerHTML=""}})},a.prototype.rebuildArray=function(e,t,n){const i=this;this.foreachBindings.forEach(function(r,s){r.arrayProperty===e&&i.rebuildForeachElement(r,t,n)})},a.prototype.rebuildForeachElement=function(e,t,n){const i=e.element,r=e.template;if(this.cleanupElementReactivity(i),i.innerHTML="",!Array.isArray(t)||0===t.length)return;const s=this,a=document.createDocumentFragment();t.forEach(function(i,o){const c=r.cloneNode(!0),p=Object.assign({},n);p[e.itemName]=t[o],p[e.indexName]=o,p.item=t[o],p.$index=o,p.__parent=n,s.bindingManager.processElementBindings(c,p),a.appendChild(c)}),i.appendChild(a)},a.prototype.makeItemReactive=function(e,t,i){if(!e||"object"!=typeof e)return e;const r=n(e,this.container);return this.itemReactivityCleanup.has(t)||this.itemReactivityCleanup.set(t,[]),this.itemReactivityCleanup.get(t).push(r),r},a.prototype.cleanupElementReactivity=function(e){this.itemReactivityCleanup.get(e)&&this.itemReactivityCleanup.delete(e)},a.prototype.cleanup=function(){this.foreachBindings.clear(),this.itemReactivityCleanup=new WeakMap},window.PACRegistry=window.PACRegistry||new function(){this.components=new Map,this.register=function(e,t){this.components.set(e,t)},this.unregister=function(e){this.components.delete(e)}},window.wakaPAC=function(e,t,o){t=t||{},o=o||{};const c=document.querySelector(e);if(!c)throw new Error("Container not found: "+e);const p={selector:e,container:c,config:{updateMode:o.updateMode||"batched",delay:o.delay||300},original:t,abstraction:null,subscriptionMap:null,bindingManager:null,foreachManager:null,initialize:function(){return this.subscriptionMap=new r(this.container),this.bindingManager=new s(this.container,this.subscriptionMap),this.foreachManager=new a(this.container,this.subscriptionMap,this.bindingManager),this.bindingManager.setupTextBindings(),this.bindingManager.setupAttributeBindings(this.original.computed),this.foreachManager.setupForeachBindings(),this.setupEventCapture(),this.abstraction=this.createReactiveAbstraction(),this.setupEventHandlers(),this.performInitialUpdate(),this},createReactiveAbstraction:function(){const e=this,t=n({},this.container);return Object.keys(this.original).forEach(function(n){"computed"!==n&&"function"!=typeof e.original[n]&&(t[n]=e.original[n])}),Object.keys(this.original).forEach(function(n){"function"==typeof e.original[n]&&"computed"!==n&&(t[n]=e.original[n].bind(t))}),this.original.computed&&(this.computedManager=new i(t,this.original.computed)),t},setupEventHandlers:function(){const e=this;this.bindingManager.getEventBindings().forEach(function(t){"click"===t.type&&e.setupClickBinding(t.element,t.target)})},setupClickBinding:function(e,t){const n=this;e.addEventListener("click",function(e){const i=n.abstraction[t];if("function"==typeof i)try{i.call(n.abstraction,e)}catch(e){}})},setupEventCapture:function(){const e=this;this.container.addEventListener("pac:change",function(t){const n=t.detail.path,i=n.join(".");e.handlePropertyChange(i),n.length>1&&e.handlePropertyChange(n[0])}),this.container.addEventListener("pac:array-change",function(t){const n=t.detail,i=n.path.join("."),r=n.newValue;e.foreachManager.rebuildArray(i,r,e.abstraction)})},handlePropertyChange:function(e){const t=this,n=this.subscriptionMap.getSubscribedElements(e);n.size>0&&(n.forEach(function(n){const i=t.subscriptionMap.getBindingForElementAndProperty(n,e);i&&"foreach"===i.type||t.bindingManager.updateElementForProperty(n,e,t.abstraction)}),this.invalidateComputedDependents(e))},invalidateComputedDependents:function(e){if(!this.computedManager)return;const t=this.computedManager.invalidateComputed(e),n=this;t.forEach(function(e){n.abstraction[e],n.handlePropertyChange(e)})},performInitialUpdate:function(){const e=this;Object.keys(this.abstraction).filter(function(t){return"function"!=typeof e.abstraction[t]&&!t.startsWith("_")}).forEach(function(t){const n=e.abstraction[t];Array.isArray(n)&&e.foreachManager.rebuildArray(t,n,e.abstraction),e.handlePropertyChange(t)}),this.original.init&&this.original.init.call(this.abstraction)}},u=p.initialize();return window.PACRegistry.register(e,p),u.abstraction}}();