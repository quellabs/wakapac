!function(){"use strict";const e=/\{\{\s*([^}]+)\s*}}/g,t=/\{\{.*}}/,n=/pac-foreach-item:\s*([^,]+),\s*index=(\d+),\s*renderIndex=(\d+)/,r=["readonly","required","selected","checked","hidden","multiple","autofocus"],a=["value","checked","visible","if","foreach","class","style","click","change","input","submit","focus","blur","keyup","keydown"],i={uniqid:(e="",t=!1)=>`${e}${(1e3*Date.now()+1e3*Math.random()).toString(16).padEnd(14,"0")}${t?`.${Math.trunc(1e8*Math.random())}`:""}`,setNestedProperty(e,t,n){const r=e.split(/[.\[\]]+/).filter(Boolean);for(let e=0;e<r.length-1;e++){const t=r[e],a=r[e+1];t in n||(n[t]=/^\d+$/.test(a)?[]:{}),n=n[t]}n[r[r.length-1]]=t},pathArrayToString(e){if(0===e.length)return"";let t=e[0];for(let n=1;n<e.length;n++){const r=e[n];/^\d+$/.test(r)?t+=`[${r}]`:t+=`.${r}`}return t},belongsToPacContainer(e,t){if(!(e instanceof Element&&e.hasAttribute("data-pac-container")))return!1;const n=t&&t.nodeType===Node.TEXT_NODE?t.parentElement:t;return n instanceof Element&&!!e.contains(n)&&n.closest("[data-pac-container]")===e},readDOMValue:e=>{let t;if(t="string"!=typeof e?e&&e.nodeType?e:null:e.startsWith("#")?document.getElementById(e.slice(1)):document.querySelector(e),!t)return!1;switch(!0){case"SELECT"===t.tagName:return t.value;case"checkbox"===t.type:return t.checked;case"radio"===t.type:{const e=document.querySelector('input[name="'+t.name+'"]:checked');return e?e.value:""}case"INPUT"===t.tagName||"TEXTAREA"===t.tagName:return t.value;default:return t.textContent||t.innerText}},writeDOMValue:(e,t)=>{let n;if(n="string"!=typeof e?e&&e.nodeType?e:null:e.startsWith("#")?document.getElementById(e.slice(1)):document.querySelector(e),!n)return!1;switch(!0){case"SELECT"===n.tagName:return n.value=t,n.dispatchEvent(new Event("change",{bubbles:!0})),!0;case"checkbox"===n.type:return n.checked=Boolean(t),n.dispatchEvent(new Event("change",{bubbles:!0})),!0;case"radio"===n.type:{const e=document.querySelector('input[name="'+n.name+'"][value="'+t+'"]');return!!e&&(e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0})),!0)}case"INPUT"===n.tagName||"TEXTAREA"===n.tagName:return n.value=t,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),!0;default:return n.textContent=t,!0}},isEqual(e,t){if(e===t)return!0;if(Number.isNaN(e)&&Number.isNaN(t))return!0;if(!e||!t||"object"!=typeof e||"object"!=typeof t)return!1;if(Array.isArray(e))return Array.isArray(t)&&e.length===t.length&&e.every((e,n)=>this.isEqual(e,t[n]));const n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every(n=>Object.hasOwn(t,n)&&this.isEqual(e[n],t[n]))}},s={_initialized:!1,initialize(){const e=this;this._initialized||(this._initialized=!0,document.addEventListener("mousedown",function(t){let n;if(0===t.button)n=513;else if(1===t.button)n=519;else{if(2!==t.button)return;n=516}e.dispatchTrackedEvent(n,t)}),document.addEventListener("mouseup",function(t){let n;if(0===t.button)n=514;else if(1===t.button)n=520;else{if(2!==t.button)return;n=517}e.dispatchTrackedEvent(n,t)}),document.addEventListener("change",function(t){"SELECT"!==t.target.tagName&&"radio"!==t.target.type&&"checkbox"!==t.target.type||e.dispatchTrackedEvent(769,t)}),document.addEventListener("input",function(t){("INPUT"===t.target.tagName&&!["radio","checkbox"].includes(t.target.type)||"TEXTAREA"===t.target.tagName)&&e.dispatchTrackedEvent(768,t)}),document.addEventListener("submit",function(t){e.dispatchTrackedEvent(770,t)}))},dispatchTrackedEvent(e,t,n={}){const r=t.target.closest("[data-pac-container]");if(!r)return;const a=this.buildParams(e,t),s=new CustomEvent("pac:event",{detail:{message:e,wParam:a.wParam,lParam:a.lParam,timestamp:Date.now(),target:t.target,id:t.target.id||null,value:i.readDOMValue(t.target),originalEvent:t,extended:n}});["preventDefault","stopPropagation","stopImmediatePropagation"].forEach(e=>{const n=s[e];s[e]=function(){n.call(this),t[e]&&t[e].call(t)}}),r.dispatchEvent(s)},buildParams(e,t){switch(e){case 513:case 516:case 519:case 514:case 517:case 520:return{wParam:this.buildMouseWParam(t),lParam:this.buildMouseLParam(t)};case 256:case 257:return{wParam:t.keyCode||t.which,lParam:this.buildKeyboardLParam(t)};case 768:case 769:return{wParam:t.target.value.length,lParam:0};case 770:{const e=new FormData(t.target),n=Object.fromEntries(e.entries());return{wParam:t.target.id||null,lParam:n}}default:return{wParam:0,lParam:0}}},buildMouseWParam(e){let t=0;return e.ctrlKey&&(t|=8),e.shiftKey&&(t|=4),e.altKey&&(t|=32),1&e.buttons&&(t|=1),2&e.buttons&&(t|=2),4&e.buttons&&(t|=16),t},buildMouseLParam(e){const t=Math.max(0,Math.min(65535,e.clientX||0));return Math.max(0,Math.min(65535,e.clientY||0))<<16|t},buildKeyboardLParam(e){let t=0;return t|=65535&(e.repeat?2:1),this.isExtendedKey(e.code)&&(t|=1<<24),"keyup"===e.type&&(t|=1<<31),t},isExtendedKey:e=>!!e&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Home","End","PageUp","PageDown","Insert","Delete","NumpadEnter","NumpadDivide","MetaLeft","MetaRight","ContextMenu"].includes(e)},o={tokens:[],currentToken:0,OPERATOR_PRECEDENCE:{"||":1,"&&":2,"===":6,"!==":6,"==":6,"!=":6,"<":7,">":7,"<=":7,">=":7,"+":8,"-":8,"*":9,"/":9,"%":9,"!":10,"unary-":10,"unary+":10},OPERATOR_TYPES:{"||":"logical","&&":"logical","===":"comparison","!==":"comparison","==":"comparison","!=":"comparison",">=":"comparison","<=":"comparison",">":"comparison","<":"comparison","+":"arithmetic","-":"arithmetic","*":"arithmetic","/":"arithmetic","%":"arithmetic"},parseExpression(e){if("object"==typeof e&&null!==e){if(e.dependencies)return e;const t=this.extractDependencies(e);return Object.assign({},e,{dependencies:t})}if(e=String(e).trim(),this.tokens=this.tokenize(e),this.currentToken=0,0===this.tokens.length)return null;const t=this.parseTernary();return t&&(t.dependencies=this.extractDependencies(t)),t},tokenize(e){const t=[];let n=0;for(;n<e.length;){const r=e[n];if(/\s/.test(r)){n++;continue}if('"'===r||"'"===r){const r=this.tokenizeString(e,n);t.push(r.token),n=r.nextIndex;continue}if(/\d/.test(r)||"."===r&&/\d/.test(e[n+1])){const r=this.tokenizeNumber(e,n);t.push(r.token),n=r.nextIndex;continue}const a=/^(===|!==|==|!=|>=|<=|&&|\|\|)/.exec(e.slice(n));if(a){const e=a[1];t.push({type:"OPERATOR",value:e,precedence:this.getOperatorPrecedence(e)}),n+=e.length;continue}const i={"(":"LPAREN",")":"RPAREN","{":"LBRACE","}":"RBRACE","[":"LBRACKET","]":"RBRACKET",",":"COMMA",".":"DOT"};if(i[r])t.push({type:i[r],value:r}),n++;else{if("+-*/<>!?:%".includes(r)){const e=this.getOperatorPrecedence(r);let a;switch(r){case"?":a="QUESTION";break;case":":a="COLON";break;default:a="OPERATOR"}t.push({type:a,value:r,precedence:e}),n++;continue}if(/[a-zA-Z_$]/.test(r)){const r=this.tokenizeIdentifier(e,n);t.push(r.token),n=r.nextIndex;continue}n++}}return t},tokenizeString(e,t){const n=e[t];let r=t+1,a="";for(;r<e.length;){const t=e[r];if("\\"===t&&r+1<e.length){const i=e[r+1];i===n||"\\"===i?(a+=i,r+=2):(a+=t,r++)}else{if(t===n)return{token:{type:"STRING",value:a},nextIndex:r+1};a+=t,r++}}throw new Error(`Unterminated string literal starting at position ${t}: expected closing ${n}`)},tokenizeNumber(e,t){const n=/^(\d*\.?\d+(?:[eE][+-]?\d+)?)/.exec(e.slice(t));if(n)return{token:{type:"NUMBER",value:parseFloat(n[1])},nextIndex:t+n[1].length}},tokenizeIdentifier(e,t){const n=/^([a-zA-Z_$][a-zA-Z0-9_$]*)/.exec(e.slice(t));if(n){const e=n[1];return{token:{type:["true","false","null","undefined"].includes(e)?"KEYWORD":"IDENTIFIER",value:e},nextIndex:t+e.length}}},getOperatorPrecedence(e){return this.OPERATOR_PRECEDENCE[e]||0},parseTernary(){let e=this.parseBinaryWithPrecedence(1);if(this.match("QUESTION")){const t=this.parseTernary();return this.consume("COLON",'Expected ":" in ternary expression'),{type:"ternary",condition:e,trueValue:t,falseValue:this.parseTernary()}}return e},parseBinaryWithPrecedence(e){let t=this.parseUnary();for(;"OPERATOR"===this.peek().type;){const n=this.getOperatorPrecedence(this.peek().value);if(n<e)break;const r=this.advance().value,a=this.parseBinaryWithPrecedence(n+1);t={type:this.OPERATOR_TYPES[r]||"arithmetic",left:t,operator:r,right:a}}return t},parseUnary(){return this.matchOperator("!","-","+")?{type:"unary",operator:this.previous().value,operand:this.parseUnary()}:this.parsePrimary()},parsePrimary(){if(this.match("LPAREN")){const e=this.parseTernary();return this.consume("RPAREN","Expected closing parenthesis"),{type:"parentheses",inner:e}}if(this.match("LBRACE"))return this.parseObjectLiteral();if(this.check("STRING"))return{type:"literal",value:this.advance().value};if(this.check("NUMBER"))return{type:"literal",value:this.advance().value};if(this.check("KEYWORD")){let e;switch(this.advance().value){case"true":e=!0;break;case"false":e=!1;break;case"null":e=null;break;case"undefined":e=void 0}return{type:"literal",value:e}}return this.check("IDENTIFIER")?this.parsePropertyAccess():null},parseObjectLiteral(){const e=[];if(!this.check("RBRACE"))do{let t;if(this.check("STRING"))t=this.advance().value;else{if(!this.check("IDENTIFIER"))throw new Error("Expected property name");t=this.advance().value}this.consume("COLON",'Expected ":" after object key');const n=this.parseTernary();e.push({key:t,value:n})}while(this.match("COMMA")&&!this.check("RBRACE"));return this.consume("RBRACE","Expected closing brace"),{type:"object",pairs:e}},parsePropertyAccess(){let e=this.advance().value;for(;;)if(this.match("DOT")){if(!this.check("IDENTIFIER"))throw new Error('Expected property name after "."');e+="."+this.advance().value}else{if(!this.match("LBRACKET"))break;{const t=this.parseTernary();this.consume("RBRACKET","Expected closing bracket"),"literal"===t.type?e+="["+JSON.stringify(t.value)+"]":e+="["+this.reconstructExpression(t)+"]"}}return{type:"property",path:e}},reconstructExpression(e){if(!e)return"";switch(e.type){case"literal":return"string"==typeof e.value?'"'+e.value+'"':String(e.value);case"property":return e.path;case"arithmetic":return`${this.reconstructExpression(e.left)} ${e.operator} ${this.reconstructExpression(e.right)}`;default:return"unknown"}},match(...e){for(const t of e)if(this.check(t))return this.advance(),!0;return!1},matchOperator(...e){if(this.check("OPERATOR")){const t=this.peek();if(e.includes(t.value))return this.advance(),!0}return!1},check(e){return!this.isAtEnd()&&this.peek().type===e},advance(){return this.isAtEnd()||this.currentToken++,this.previous()},isAtEnd(){return this.currentToken>=this.tokens.length},peek(){return this.tokens[this.currentToken]||{type:"EOF",value:null}},previous(){return this.tokens[this.currentToken-1]},consume(e,t){if(this.check(e))return this.advance();throw new Error(t+` at token: ${JSON.stringify(this.peek())}`)},evaluate(e,t,n=null){if(e)switch(e.type){case"literal":return e.value;case"property":return this.getProperty(e.path,t,n);case"parentheses":return this.evaluate(e.inner,t,n);case"object":return this.evaluateObjectLiteral(e,t,n);case"ternary":return this.evaluate(e.condition,t,n)?this.evaluate(e.trueValue,t,n):this.evaluate(e.falseValue,t,n);case"logical":{const r=this.evaluate(e.left,t,n);return"&&"===e.operator?!!r&&this.evaluate(e.right,t,n):"||"===e.operator&&(!!r||this.evaluate(e.right,t,n))}case"comparison":case"arithmetic":{const r=this.evaluate(e.left,t,n),a=this.evaluate(e.right,t,n);return this.performOperation(r,e.operator,a)}case"unary":{const r=this.evaluate(e.operand,t,n);switch(e.operator){case"!":return!r;case"-":return-r;case"+":return+r;default:return r}}default:return}},getProperty(e,t,n=null){if(!t||!e)return;let r=e;if(n&&n.resolveScopedPath&&(r=n.resolveScopedPath(e)),-1===r.indexOf(".")&&-1===r.indexOf("["))return r in t?t[r]:void 0;const a=r.split(/[.\[\]]+/).filter(Boolean);let i=t;for(let e=0;e<a.length;e++){if(null==i)return;i=i[a[e]]}return i},evaluateObjectLiteral(e,t,n=null){const r={};return e.pairs&&e.pairs.forEach(({key:e,value:a})=>{r[e]=this.evaluate(a,t,n)}),r},performOperation(e,t,n){switch(t){case"+":return e+n;case"-":return Number(e)-Number(n);case"*":return Number(e)*Number(n);case"/":return Number(e)/Number(n);case"%":return Number(e)%Number(n);case"===":return e===n;case"!==":return e!==n;case"==":return e==n;case"!=":return e!=n;case">=":return e>=n;case"<=":return e<=n;case">":return e>n;case"<":return e<n;default:return!1}},extractDependencies(e){if(!e)return[];const t=new Set,n=e=>{if(e)switch(e.type){case"property":{const n=e.path.split(/[.[]/,1)[0];n&&!["true","false","null","undefined"].includes(n)&&t.add(n);break}case"ternary":n(e.condition),n(e.trueValue),n(e.falseValue);break;case"logical":case"comparison":case"arithmetic":n(e.left),n(e.right);break;case"unary":n(e.operand);break;case"parentheses":n(e.inner);break;case"object":e.pairs&&e.pairs.forEach(e=>n(e.value))}};return n(e),Array.from(t)},parseBindingString(e){const t=[];let n="",r=!1,a="",i=0,s=0;for(let o=0;o<e.length;o++){const c=e[o],h=o>0&&"\\"===e[o-1];'"'!==c&&"'"!==c||h||(r?c===a&&(r=!1,a=""):(r=!0,a=c)),r||("("===c?i++:")"===c?i--:"{"===c?s++:"}"===c&&s--),","!==c||r||0!==i||0!==s?n+=c:(this.addBindingPairIfValid(n,t),n="")}return this.addBindingPairIfValid(n,t),t},addBindingPairIfValid(e,t){const n=e.trim();if(!n)return;const r=this.findBindingColon(n);-1===r?t.push({type:n,target:""}):t.push({type:n.substring(0,r).trim(),target:n.substring(r+1).trim()})},findBindingColon(e){for(const t of a)if(e.startsWith(t+":"))return t.length;let t=!1,n="",r=0;for(let a=0;a<e.length;a++){const i=e[a],s=a>0&&"\\"===e[a-1];if('"'!==i&&"'"!==i||s||(t?i===n&&(t=!1,n=""):(t=!0,n=i)),!t)if("("===i)r++;else if(")"===i)r--;else if(":"===i&&0===r)return a}return-1}},c={cache:new Map,maxSize:1e3,parseExpression(e){const t=String(e).trim();if(this.cache.has(t))return this.cache.get(t);const n=o.parseExpression(e);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}return this.cache.set(t,n),n},clear(){this.cache.clear()}};function h(e){this.context=e}function l(e,t,n=null){const r=this;e.hasAttribute("data-pac-container")||e.setAttribute("data-pac-container",i.uniqid()),this.originalAbstraction=t,this.parent=n,this.container=e,this.abstraction=this.createReactiveAbstraction(),this.domUpdater=new h(this),this.dependencies=this.getDependencies(),this.interpolationMap=new Map,this.textInterpolationMap=new Map,this.scanAndRegisterNewElements(this.container),this.boundHandlePacEvent=function(e){r.handlePacEvent(e)},this.boundHandleReactiveChange=function(e){r.handleReactiveChange(e)},this.boundHandleArrayChange=function(e){r.handleArrayChange(e)},this.container.addEventListener("pac:event",this.boundHandlePacEvent),this.container.addEventListener("pac:change",this.boundHandleReactiveChange),this.container.addEventListener("pac:array-change",this.boundHandleArrayChange)}h.prototype.updateTextNode=function(t,n){const r=this,a=n.replace(e,(e,n)=>{try{const e=c.parseExpression(n),a=t.nodeType===Node.TEXT_NODE?t.parentElement:t,i={resolveScopedPath:e=>r.context.resolveScopedPath(e,a)},s=o.evaluate(e,r.context.abstraction,i);return null!=s?String(s):""}catch(t){return e}});t.textContent!==a&&(t.textContent=a)},h.prototype.updateAttributeBinding=function(e,t,n){try{const r=c.parseExpression(n.target),a={resolveScopedPath:t=>this.context.resolveScopedPath(t,e)},i=o.evaluate(r,this.context.abstraction,a);switch(t){case"value":this.applyValueBinding(e,i);break;case"checked":this.applyCheckedBinding(e,i);break;case"visible":this.applyVisibleBinding(e,i);break;case"class":this.applyClassBinding(e,i);break;case"style":this.applyStyleBinding(e,i);break;default:this.applyAttributeBinding(e,t,i)}}catch(e){}},h.prototype.applyValueBinding=function(e,t){if("radio"!==e.type){if("value"in e){const n=String(t||"");e.value!==n&&(e.value=n)}}else e.checked=e.value===String(t)},h.prototype.applyCheckedBinding=function(e,t){if("checkbox"===e.type||"radio"===e.type){const n=Boolean(t);e.checked!==n&&(e.checked=n)}},h.prototype.applyVisibleBinding=function(e,t){if(t)e.hasAttribute("data-pac-hidden")&&(e.style.display=e.getAttribute("data-pac-orig-display")||"",e.removeAttribute("data-pac-hidden"),e.removeAttribute("data-pac-orig-display"));else if(!e.hasAttribute("data-pac-hidden")){const t=getComputedStyle(e).display;"none"!==t&&e.setAttribute("data-pac-orig-display",t),e.style.display="none",e.setAttribute("data-pac-hidden","true")}},h.prototype.applyClassBinding=function(e,t){"object"!=typeof t||null===t?"string"==typeof t&&(e.className=t):Object.keys(t).forEach(n=>{t[n]?e.classList.add(n):e.classList.remove(n)})},h.prototype.applyStyleBinding=function(e,t){if("object"!=typeof t||null===t||Array.isArray(t))"string"==typeof t&&(e.style.cssText=t);else for(const n in t)null!=t[n]&&(n.startsWith("--")?e.style.setProperty(n,t[n]):e.style[n]=t[n])},h.prototype.applyAttributeBinding=function(e,t,n){"enable"===t?e.toggleAttribute("disabled",!n):r.includes(t)?e.toggleAttribute(t,!!n):null!=n?e.setAttribute(t,n):e.removeAttribute(t)},l.prototype.destroy=function(){this.container.removeEventListener("pac:event",this.boundHandlePacEvent),this.container.removeEventListener("pac:change",this.boundHandleReactiveChange),this.container.removeEventListener("pac:array-change",this.boundHandleArrayChange),this.boundHandlePacEvent=null,this.boundHandleReactiveChange=null,this.boundHandleArrayChange=null},l.prototype.scanAndRegisterNewElements=function(e){const t=this,n=this.scanBindings(e),r=this.scanTextBindings(e);n.forEach((t,n)=>{n!==e&&this.interpolationMap.set(n,t)}),r.forEach((e,t)=>{this.textInterpolationMap.set(t,e)}),n.forEach((n,r)=>{const{bindings:a}=n;if(a.foreach&&r!==e){const e=i.uniqid("foreach");r.setAttribute("data-pac-foreach-id",e);const s=a.foreach.target,o=this.inferArrayRoot(s);r.setAttribute("data-pac-array",o),Object.assign(n,{foreachExpr:a.foreach.target,sourceArray:o,foreachId:e,depth:t.calculateForEachDepth(r),template:r.innerHTML,itemVar:r.getAttribute("data-pac-item")||"item",indexVar:r.getAttribute("data-pac-index")||"index"})}}),n.forEach((e,n)=>{Object.keys(e.bindings).forEach(r=>{const a=e.bindings[r];t.domUpdater.updateAttributeBinding(n,r,a)})}),r.forEach((e,n)=>{t.domUpdater.updateTextNode(n,e.template)}),Array.from(n.entries()).filter(([t,n])=>n.bindings.foreach&&t!==e).sort(([,e],[,t])=>{const n=e.depth;return t.depth-n}).forEach(([e])=>{this.renderForeach(e)})},l.prototype.getDependencies=function(){const e=new Map,t=this.originalAbstraction.computed||{},n=new Set,r=new Proxy(this.originalAbstraction,{get:(e,t)=>("string"==typeof t&&n.add(t),e[t])});return Object.keys(t).forEach(a=>{n.clear(),t[a].call(r),n.forEach(t=>{e.has(t)||e.set(t,[]),e.get(t).push(a)})}),e},l.prototype.inferArrayRoot=function(e){for(const[t,n]of this.dependencies){const r=this.abstraction[t],a=Array.isArray(r);if(n.includes(e)&&a)return t}return e},l.prototype.handleAttributeChanges=function(e,t){const n=this,r=e.detail.path[0];this.interpolationMap.forEach((a,i)=>{const{bindings:s}=a;Object.keys(s).forEach(a=>{if(["foreach","click"].includes(a))return;const o=s[a];let c=o.dependencies.some(n=>t.includes(n)||e.detail.path.join(".").startsWith(n+".")||e.detail.path.join(".").startsWith(n+"["));if(!c){const e=i.closest("[data-pac-foreach-id]");if(e){const t=n.interpolationMap.get(e);t&&t.sourceArray===r&&(c=!0)}}c&&n.domUpdater.updateAttributeBinding(i,a,o)})})},l.prototype.handleTextInterpolation=function(e,t){const n=this,r=e.detail.path[0];n.textInterpolationMap.forEach((a,i)=>{let s=a.dependencies.some(n=>t.includes(n)||e.detail.path.join(".").startsWith(n+".")||e.detail.path.join(".").startsWith(n+"["));if(!s){const e=i.parentElement?.closest("[data-pac-foreach-id]");if(e){const t=n.interpolationMap.get(e);t&&t.sourceArray===r&&(s=!0)}}s&&n.domUpdater.updateTextNode(i,a.template)})},l.prototype.handlePacEvent=function(e){switch(e.detail.message){case 513:case 519:case 516:break;case 514:case 520:case 517:this.handleDomClicks(e);break;case 770:this.handleDomSubmit(e);break;case 769:case 768:this.handleDomChange(e)}},l.prototype.handleDomClicks=function(e){const t=this.interpolationMap.get(e.detail.target);if(!t?.bindings?.click)return;const n=this.abstraction[t.bindings.click.target];if("function"==typeof n)try{const t=this.extractClosestForeachContext(e.detail.target);if(!t)return void n.call(this.abstraction,e);const r=Array.from(this.interpolationMap.entries()).find(([,e])=>e.foreachId===t.foreachId)?.[0];if(!r)return void n.call(this.abstraction,e);const a=this.interpolationMap.get(r),i={resolveScopedPath:e=>this.resolveScopedPath(e,r)},s=o.evaluate(c.parseExpression(a.foreachExpr),this.abstraction,i);n.call(this.abstraction,s[t.index],t.index,e)}catch(e){}},l.prototype.handleDomSubmit=function(e){const t=this.interpolationMap.get(e.detail.target);if(!t?.bindings?.submit)return;const n=this.abstraction[t.bindings.submit.target];if("function"==typeof n)try{n.call(this.abstraction,e)}catch(e){}},l.prototype.handleDomChange=function(e){const t=this,n=e.detail.target,r=this.interpolationMap.get(n);if(r){if(r.bindings.value){const a=r.bindings.value,s=t.resolveScopedPath(a.target,n);i.setNestedProperty(s,e.detail.value,this.abstraction)}if(r.bindings.checked){const a=r.bindings.checked,s=t.resolveScopedPath(a.target,n);"checkbox"===n.type?i.setNestedProperty(s,e.detail.target.checked,this.abstraction):"radio"===n.type&&e.detail.target.checked&&i.setNestedProperty(s,e.detail.value,this.abstraction)}}},l.prototype.handleReactiveChange=function(e){const t=i.pathArrayToString(e.detail.path),n=[t];this.dependencies.has(t)&&n.push(...this.dependencies.get(t));const r=e.detail.path[0];this.dependencies.has(r)&&n.push(...this.dependencies.get(r)),this.handleTextInterpolation(e,n),this.handleAttributeChanges(e,n),n.forEach(n=>{if(n===t&&e.detail.path.length>1)return;const r="function"==typeof this.abstraction.computed?.[n],a=1===e.detail.path.length&&Array.isArray(this.abstraction[n]);(r||a)&&this.findForeachElementsByArrayPath(n).forEach(e=>{this.shouldRebuildForeach(e)&&this.renderForeach(e)})})},l.prototype.handleArrayChange=function(e){const t=i.pathArrayToString(e.detail.path);this.findForeachElementsByArrayPath(t).forEach(e=>{this.renderForeach(e)})},l.prototype.scanBindings=function(e){const t=this,n=new Map;return e.querySelectorAll("[data-pac-bind]").forEach(e=>{if(n.has(e))return;if(!i.belongsToPacContainer(t.container,e))return;const r=e.getAttribute("data-pac-bind"),a=o.parseBindingString(r),s={};a.forEach(e=>{s[e.type]={target:e.target,dependencies:this.extractDependencies(e.target)}}),n.set(e,{bindingString:r,bindings:s})}),n},l.prototype.scanTextBindings=function(e){const n=new Map,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>t.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});let a;for(;a=r.nextNode();)n.has(a)||i.belongsToPacContainer(this.container,a)&&n.set(a,{template:a.textContent,dependencies:this.extractInterpolationDependencies(a.textContent)});return n},l.prototype.extractInterpolationDependencies=function(t){const n=new Set;return t.replace(e,(e,t)=>(this.extractDependencies(t.trim()).forEach(e=>n.add(e)),e)),Array.from(n)},l.prototype.extractDependencies=function(e){try{const t=c.parseExpression(e);return t?.dependencies||[]}catch(e){return[]}},l.prototype.createReactiveAbstraction=function(){const e=this,t=function(e,t){const n=["push","pop","shift","unshift","splice","sort","reverse"];return e&&"object"==typeof e?function e(r,a){return a=a||[],new Proxy(r,{get:function(r,i){const s=r[i];if(Array.isArray(r)&&"function"==typeof s&&n.includes(i))return function(){if("push"===i||"unshift"===i)for(let t=0;t<arguments.length;t++)arguments[t]&&"object"==typeof arguments[t]&&!arguments[t]._isReactive&&(arguments[t]=e(arguments[t],a.concat([r.length+t])),arguments[t]._isReactive=!0);else if("splice"===i&&arguments.length>2)for(let t=2;t<arguments.length;t++)arguments[t]&&"object"==typeof arguments[t]&&!arguments[t]._isReactive&&(arguments[t]=e(arguments[t],a.concat([arguments[0]+t-2])),arguments[t]._isReactive=!0);const n=Array.prototype.slice.call(r),s=Array.prototype[i].apply(r,arguments),o=Array.prototype.slice.call(r);return t.dispatchEvent(new CustomEvent("pac:array-change",{detail:{path:a,oldValue:n,newValue:o,method:i}})),s};const o=Object.getOwnPropertyDescriptor(r,i);if(o&&o.get&&!o.set)return s;if("function"==typeof s)return s;if(s&&"object"==typeof s&&!s._isReactive){const t=e(s,a.concat([i]));return t._isReactive=!0,r[i]=t,t}return s},set:function(n,r,i){const s=n[r],o=a.concat([r]);return s===i||(i&&"object"==typeof i?(n[r]=e(i,o),n[r]._isReactive=!0):n[r]=i,Array.isArray(i)&&t.dispatchEvent(new CustomEvent("pac:array-change",{detail:{path:o,oldValue:s,newValue:n[r],method:"assignment"}})),t.dispatchEvent(new CustomEvent("pac:change",{detail:{path:o,oldValue:s,newValue:n[r]}}))),!0}})}(e,[]):e}(this.originalAbstraction,this.container);Object.keys(this.originalAbstraction).forEach(function(n){"function"==typeof e.originalAbstraction[n]&&"computed"!==n&&(t[n]=e.originalAbstraction[n].bind(t))});const n=this.originalAbstraction.computed||{};return Object.keys(n).forEach(function(e){Object.defineProperty(t,e,{get:function(){return n[e].call(t)},enumerable:!0,configurable:!0})}),t},l.prototype.calculateForEachDepth=function(e){let t=0,n=e.parentElement;for(;n&&n!==this.container;)n.hasAttribute("data-pac-bind")&&n.getAttribute("data-pac-bind").includes("foreach:")&&t++,n=n.parentElement;return t},l.prototype.findParentForeachElement=function(e){let t=e.parentElement;for(;t&&t!==this.container;){if(t.hasAttribute("data-pac-bind")&&t.getAttribute("data-pac-bind").includes("foreach:"))return t;t=t.parentElement}return null},l.prototype.renderForeach=function(e){const t=this.interpolationMap.get(e);if(!t||!t.foreachId)return;this.cleanupForeachMaps(e);const n={resolveScopedPath:t=>this.resolveScopedPath(t,e)};try{const r=o.evaluate(c.parseExpression(t.foreachExpr),this.abstraction,n);if(!r)return;if(!Array.isArray(r))return void(e.innerHTML="");const a=this.getSourceArrayForFiltered(t.foreachExpr,r);e._pacPreviousArray=r,e.innerHTML="",r.forEach((n,r)=>{const i=this.findOriginalIndex(n,a,r);e.innerHTML+=`\x3c!-- pac-foreach-item: ${t.foreachId}, index=${i}, renderIndex=${r} --\x3e`+t.template+"\x3c!-- /pac-foreach-item --\x3e"}),this.scanAndRegisterNewElements(e)}catch(e){}},l.prototype.getSourceArrayForFiltered=function(e,t){if(this.originalAbstraction.computed&&this.originalAbstraction.computed[e]){const t=this.dependencies.get(e)||[];for(const e of t){const t=this.abstraction[e];if(Array.isArray(t))return t}}return Array.isArray(this.abstraction[e])?this.abstraction[e]:t},l.prototype.findOriginalIndex=function(e,t,n){for(let n=0;n<t.length;n++)if(t[n]===e)return n;if(e&&"object"==typeof e&&void 0!==e.id)for(let n=0;n<t.length;n++){const r=t[n];if(r&&"object"==typeof r&&r.id===e.id)return n}for(let n=0;n<t.length;n++)if(i.isEqual(t[n],e))return n;return n},l.prototype.resolveScopedPath=function(e,t){if(!e.includes("."))return e;const n=this.findForeachElementForScopedPath(e,t);if(!n)return e;const r=this.interpolationMap.get(n);if(!r||!r.bindings||!r.bindings.foreach)return e;const a=this.extractIndexFromComments(t,r.foreachId);if(null===a)return e;const i=e.substring(r.itemVar.length+1);return this.resolveArrayExpression(r.bindings.foreach.target,n,t)+"["+a+"]"+(i?"."+i:"")},l.prototype.shouldRebuildForeach=function(e){const t=this.interpolationMap.get(e);if(!t)return!1;const n={resolveScopedPath:t=>this.resolveScopedPath(t,e)},r=o.evaluate(c.parseExpression(t.foreachExpr),this.abstraction,n);if(!Array.isArray(r))return!1;const a=e._pacPreviousArray;if(!a)return!0;if(r.length!==a.length)return!0;for(let e=0;e<r.length;e++)if(r[e]!==a[e])return!0;return!1},l.prototype.findForeachElementForScopedPath=function(e,t){const n=e.split(".")[0];let r=t.nodeType===Node.TEXT_NODE?t.parentElement:t;for(;r&&r!==this.container;){const e=this.interpolationMap.get(r);if(e&&e.bindings&&e.bindings.foreach&&e.itemVar===n)return r;r=r.parentElement}return null},l.prototype.findForeachElementsByArrayPath=function(e){const t=[];for(const[n,r]of this.interpolationMap)r.bindings&&r.bindings.foreach&&(r.foreachExpr!==e&&r.sourceArray!==e||t.push(n));return t},l.prototype.extractClosestForeachContext=function(e){let t=e;for(;t&&t!==this.container;){let e=t.previousSibling;for(;e;){if(e.nodeType===Node.COMMENT_NODE){const t=e.textContent.trim().match(n);if(t)return{foreachId:t[1].trim(),index:parseInt(t[2],10),renderIndex:parseInt(t[3],10)}}e=e.previousSibling}t=t.parentElement}return null},l.prototype.extractIndexFromComments=function(e,t){let r=e.nodeType===Node.TEXT_NODE?e.parentElement:e;for(;r&&r!==this.container;){let e=r.previousSibling;for(;e;){if(e.nodeType===Node.COMMENT_NODE){const r=e.textContent.trim().match(n);if(r&&r[1].trim()===t)return parseInt(r[2],10)}e=e.previousSibling}r=r.parentElement}return null},l.prototype.resolveArrayExpression=function(e,t,n){if(!e.includes("."))return e;const r=this.findParentForeachElement(t);if(!r)return e;const a=this.interpolationMap.get(r);if(!a||!a.bindings.foreach)return e;if(e.startsWith(a.itemVar+".")){const t=this.extractIndexFromComments(n,a.foreachId);if(null!==t){const i=this.resolveArrayExpression(a.foreachExpr,r,n);return e.replace(a.itemVar+".",i+"["+t+"].")}}return e},l.prototype.cleanupForeachMaps=function(e){const t=[],n=[];this.interpolationMap.forEach((n,r)=>{e.contains(r)&&r!==e&&t.push(r)}),this.textInterpolationMap.forEach((t,r)=>{e.contains(r)&&n.push(r)}),t.forEach(e=>{this.interpolationMap.delete(e)}),n.forEach(e=>{this.textInterpolationMap.delete(e)})},window.PACRegistry=window.PACRegistry||new function(){this.components=new Map,this.register=function(e,t){this.components.set(e,t)},this.unregister=function(e){this.components.delete(e)}},window.wakaPAC=function(e,t,n){s.initialize();const r=document.querySelector(e);if(!r)throw new Error(`Container not found: ${e}`);const a={selector:e,container:r,config:Object.assign({updateMode:"immediate",delay:300},n),context:new l(r,t),initialize:function(){return this}},i=a.initialize();return window.PACRegistry.register(e,a),i.context.abstraction}}();