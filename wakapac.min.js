!function(){"use strict";const e=["push","pop","shift","unshift","splice","sort","reverse"],t=["readonly","required","selected","checked","hidden","multiple"],i=["input","change","click","submit","focus","blur","keyup","keydown"],n={enter:"Enter",escape:"Escape",esc:"Escape",space:" ",tab:"Tab",delete:["Delete","Backspace"],del:["Delete","Backspace"],up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},a={hasProxy:"undefined"!=typeof Proxy,isReactive:e=>e&&"object"==typeof e&&!e.nodeType&&!(e instanceof Date)&&!(e instanceof RegExp)&&!(e instanceof File),isEqual(e,t){if(e===t)return!0;if(!e||!t||typeof e!=typeof t||"object"!=typeof e)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!a.isEqual(e[i],t[i]))return!1;return!0}const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let n=0;n<i.length;n++){const r=i[n];if(!t.hasOwnProperty(r)||!a.isEqual(e[r],t[r]))return!1}return!0},generateId:()=>Date.now()+"_"+(1e4*Math.random()|0),isEventType:e=>/^(click|submit|change|input|focus|blur|key(up|down))$/.test(e),splitPath:e=>e&&"string"==typeof e?e.split("."):[],getNestedValue:(e,t)=>t?a.splitPath(t).reduce(((e,t)=>e&&e.hasOwnProperty(t)?e[t]:void 0),e):e,formatValue:e=>null==e?"":"object"==typeof e?Array.isArray(e)?`[${e.length} items]`:JSON.stringify(e,null,2):String(e)};function r(){this.components=new Map,this.hierarchyCache=new WeakMap}function s(t,i,n=""){return a.isReactive(t)?a.hasProxy?function(t,i,n){Object.keys(t).forEach((e=>{t.hasOwnProperty(e)&&a.isReactive(t[e])&&(t[e]=s(t[e],i,n?`${n}.${e}`:e))})),Array.isArray(t)&&t.forEach(((e,r)=>{a.isReactive(e)&&(t[r]=s(e,i,n?`${n}.${r}`:r))}));const r={},o=Array.isArray(t);o&&e.forEach((e=>{r[e]=t[e]}));return new Proxy(t,{get:(e,t)=>o&&r[t]?function(...o){const c=r[t].apply(e,o);return/^(push|unshift|splice)$/.test(t)&&e.forEach(((t,r)=>{a.isReactive(t)&&!t._isReactive&&(e[r]=s(t,i,`${n}.${r}`))})),i(n||"root",e,"array-mutation",{method:t,args:o}),c}:e[t],set(e,t,r){const o=e[t];if(a.isReactive(r)&&(r=s(r,i,n?`${n}.${t}`:t)),e[t]=r,!a.isEqual(o,r)){const e=n?`${n}.${t}`:t;if(i(e,r,"set",{oldValue:o}),n){const t=n.split(".")[0];i(t,null,"nested-change",{nestedPath:e,oldValue:o,newValue:r})}}return!0},deleteProperty(e,t){const a=e[t];delete e[t];const r=n?`${n}.${t}`:t;if(i(r,void 0,"delete",{oldValue:a}),n){const e=n.split(".")[0];i(e,null,"nested-change",{nestedPath:r,oldValue:a,newValue:void 0})}return!0}})}(t,i,n):function(t,i,n){Array.isArray(t)&&e.forEach((e=>{const a=t[e];Object.defineProperty(t,e,{value:function(...t){const r=a.apply(this,t);return i(n||"root",this,"array-mutation",{method:e,args:t}),r},enumerable:!1,configurable:!0})}));return Object.keys(t).forEach((e=>{t.hasOwnProperty(e)&&a.isReactive(t[e])&&(t[e]=s(t[e],i,n?`${n}.${e}`:e))})),Object.defineProperty(t,"_isReactive",{value:!0,enumerable:!1}),t}(t,i,n):t}r.prototype={register(e,t){this.components.set(e,t),this.hierarchyCache=new WeakMap},unregister(e){const t=this.components.get(e);return t&&(this.components.delete(e),this.hierarchyCache=new WeakMap),t},getHierarchy(e){if(this.hierarchyCache.has(e))return this.hierarchyCache.get(e);let t=null,i=e.parentElement;for(;i&&!t;)this.components.forEach((e=>{e.container===i&&(t=e)})),i=i.parentElement;const n=[];this.components.forEach((t=>{e.contains(t.container)&&t.container!==e&&n.push(t)}));const a={parent:t,children:n};return this.hierarchyCache.set(e,a),a}};const o={cache:new Map,parse(e){if(e=e.trim(),this.cache.has(e))return this.cache.get(e);const t=this.parseTernary(e)||this.parseLogical(e)||this.parseComparison(e)||this.parseUnary(e)||this.parseProperty(e);return this.cache.set(e,t),t},parseProperty(e){return{type:"property",path:e,dependencies:this.extractDependencies(e)}},parseComparison(e){const t=e.match(/^(.+?)\s*(===|!==|==|!=|>=|<=|>|<)\s*(.+?)$/);if(!t)return null;const[,i,n,a]=t;return{type:"comparison",left:i.trim(),operator:n.trim(),right:this.parseValue(a.trim()),dependencies:this.extractDependencies(i.trim())}},parseLogical(e){const t=e.match(/^(.+?)\s*(&&|\|\|)\s*(.+?)$/);if(!t)return null;const[,i,n,a]=t;return{type:"logical",left:i.trim(),operator:n.trim(),right:a.trim(),dependencies:[...this.extractDependencies(i.trim()),...this.extractDependencies(a.trim())]}},parseUnary(e){const t=e.match(/^!\s*(.+)$/);if(!t)return null;const[,i]=t;return{type:"unary",operator:"!",operand:i.trim(),dependencies:this.extractDependencies(i.trim())}},parseTernary(e){const t=e.match(/^(.+?)\s*\?\s*(.+?)\s*:\s*(.+?)$/);if(!t)return null;const[,i,n,a]=t;return{type:"ternary",condition:i.trim(),trueValue:this.parseValue(n.trim()),falseValue:this.parseValue(a.trim()),dependencies:this.extractDependencies(i.trim())}},parseValue:e=>(e=e.trim()).startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?{type:"literal",value:e.slice(1,-1)}:/^\d+(\.\d+)?$/.test(e)?{type:"literal",value:parseFloat(e)}:"true"===e||"false"===e?{type:"literal",value:"true"===e}:{type:"property",path:e},extractDependencies(e){const t=[],i=["true","false","null","undefined","NaN","Infinity"],n=/\b([a-zA-Z_$][a-zA-Z0-9_$]*)(?:\.[a-zA-Z_$][a-zA-Z0-9_$]*|\[[^\]]+\])*/g;let a;for(;a=n.exec(e);){a[0];const e=a[1];i.includes(e)||t.includes(e)||t.push(e)}return t},evaluate(e,t){switch(e.type){case"ternary":return this.evaluateCondition(e.condition,t)?this.evaluateValue(e.trueValue,t):this.evaluateValue(e.falseValue,t);case"logical":const i=this.evaluateCondition(e.left,t);return"&&"===e.operator?!!i&&this.evaluateCondition(e.right,t):"||"===e.operator&&(!!i||this.evaluateCondition(e.right,t));case"unary":const n=this.evaluateCondition(e.operand,t);return"!"===e.operator?!n:n;case"comparison":const r=a.getNestedValue(t,e.left),s=this.evaluateValue(e.right,t);return this.performComparison(r,e.operator,s);case"property":return a.getNestedValue(t,e.path);default:return}},evaluateCondition(e,t){const i=e.match(/^(.+?)\s*(&&|\|\|)\s*(.+?)$/);if(i){const[,e,n,a]=i,r=this.evaluateCondition(e.trim(),t);return"&&"===n?!!r&&this.evaluateCondition(a.trim(),t):!!r||this.evaluateCondition(a.trim(),t)}const n=e.match(/^(.+?)\s*(===|!==|==|!=|>=|<=|>|<)\s*(.+?)$/);if(n){const[,e,i,r]=n,s=a.getNestedValue(t,e.trim()),o=this.parseAndEvaluateValue(r.trim(),t);return this.performComparison(s,i,o)}if(/^[a-zA-Z_$][a-zA-Z0-9_$]*(\.[a-zA-Z_$][a-zA-Z0-9_$]*)*$/.test(e))return Boolean(a.getNestedValue(t,e));const r=this.parse(e);return Boolean(this.evaluate(r,t))},evaluateValue:(e,t)=>"literal"===e.type?e.value:"property"===e.type?a.getNestedValue(t,e.path):void 0,parseAndEvaluateValue(e,t){const i=this.parseValue(e);return this.evaluateValue(i,t)},performComparison(e,t,i){switch(t){case"===":return e===i;case"!==":return e!==i;case"==":return e==i;case"!=":return e!=i;case">=":return e>=i;case"<=":return e<=i;case">":return e>i;case"<":return e<i;default:return!1}}};function c(e,r={},c={}){const d=document.querySelector(e);if(!d)throw new Error(`Container not found: ${e}`);const l={container:d,config:Object.assign({updateMode:"immediate",delay:300,deepReactivity:!0},c),original:r,abstraction:null,bindings:new Map,bindingIndex:new Map,computedCache:new Map,computedDeps:new Map,propertyDeps:new Map,expressionCache:new Map,lastValues:new Map,pendingUpdates:null,pendingValues:null,updateTimeouts:new Map,parent:null,children:new Set,eventListeners:new Map,initialize(){return this.setupBindings(),this.abstraction=this.createReactiveAbstraction(),this.setupEventHandling(),this.performInitialUpdate(),this},createReactiveAbstraction(){const e={};return this.setupComputedProperties(e),Object.keys(this.original).forEach((t=>{if(this.original.hasOwnProperty(t)&&"computed"!==t){const i=this.original[t];"function"==typeof i?e[t]=i.bind(e):this.createReactiveProperty(e,t,i)}})),Object.assign(e,{notifyParent:(e,t)=>this.notifyParent(e,t),sendToChildren:(e,t)=>this.sendToChildren(e,t),sendToChild:(e,t,i)=>this.sendToChild(e,t,i),findChild:e=>Array.from(this.children).find(e),toJSON:()=>this.serializeToJSON(),control:(e,t={})=>this.makeHttpRequest(e,t)}),e},setupComputedProperties(e){this.original.computed&&Object.keys(this.original.computed).forEach((t=>{const i=this.original.computed[t];if("function"==typeof i){const n=this.analyzeComputedDependencies(i);this.computedDeps.set(t,n),n.forEach((e=>{this.propertyDeps.has(e)||this.propertyDeps.set(e,[]),this.propertyDeps.get(e).includes(t)||this.propertyDeps.get(e).push(t)})),Object.defineProperty(e,t,{get:()=>{if(this.computedCache.has(t))return this.computedCache.get(t);try{const n=i.call(e);return this.computedCache.set(t,n),n}catch(e){return void console.error(`Error computing property '${t}':`,e)}},enumerable:!0})}}))},analyzeComputedDependencies(e){const t=[],i=/this\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g;let n;for(;n=i.exec(e.toString());){const e=n[1];!this.original.hasOwnProperty(e)||this.original.computed&&this.original.computed.hasOwnProperty(e)||t.includes(e)||t.push(e)}return t},createReactiveProperty(e,t,i){let n=i;this.config.deepReactivity&&a.isReactive(n)&&(n=s(n,((e,t,i,n)=>{this.handleDeepChange(e,t,i,n)}),t)),Object.defineProperty(e,t,{get:()=>n,set:e=>{if(a.isReactive(n)||a.isReactive(e)||!a.isEqual(n,e)){const i=n;this.config.deepReactivity&&a.isReactive(e)&&(e=s(e,((e,t,i,n)=>{this.handleDeepChange(e,t,i,n)}),t)),n=e,this.scheduleUpdate(t,e),this.updateComputedProperties(t),this.notifyParent("propertyChange",{property:t,oldValue:i,newValue:e})}},enumerable:!0})},setupBindings(){this.setupTextBindings(),this.setupAttributeBindings(),this.buildBindingIndex()},setupTextBindings(){const e=document.createTreeWalker(this.container,NodeFilter.SHOW_TEXT,null,!1);let t;for(;t=e.nextNode();){0;const e=t.textContent,i=e.match(/\{\{\s*([^}]+)\s*\}\}/g);i&&i.forEach(((i,n)=>{const a=i.replace(/^\{\{\s*|\s*\}\}$/g,"").trim(),r=this.createBinding("text",t,{target:a,originalText:e,fullMatch:i,parsedExpression:null,dependencies:null});this.bindings.set(r.id,r)}))}},setupAttributeBindings(){const e=this.container.querySelectorAll("[data-pac-bind]");Array.from(e).forEach((e=>{const t=e.getAttribute("data-pac-bind").split(",").map((e=>{const[t,i]=e.trim().split(":").map((e=>e.trim()));return{type:t,target:i}}));this.reorderBindings(t).forEach((({type:t,target:i})=>{const n=this.createBindingByType(e,t,i);n&&this.bindings.set(n.id,n)}))}))},buildBindingIndex(){this.bindingIndex.clear(),this.unparsedBindings=new Set,this.bindings.forEach((e=>{e.target&&this.unparsedBindings.add(e)}))},getParsedExpression(e){return e.parsedExpression||(e.parsedExpression=o.parse(e.target),e.dependencies=e.parsedExpression.dependencies||[],e.dependencies.forEach((t=>{this.bindingIndex.has(t)||this.bindingIndex.set(t,new Set),this.bindingIndex.get(t).add(e)}))),e.parsedExpression},createBinding(e,t,i){const n={id:a.generateId(),type:e,element:t,...i};return i.target&&(n.property=a.splitPath(i.target)[0],n.propertyPath=i.target),n},reorderBindings(e){const t={foreach:1,if:2,visible:3,value:4,checked:4,click:5,change:5,input:5,submit:5,focus:5,blur:5,keyup:5,keydown:5};return e.sort(((e,i)=>(t[e.type]||6)-(t[i.type]||6)))},createBindingByType(e,t,i){if("foreach"===t){const t=this.createForeachBinding(e,i);return e.innerHTML="",t}return"if"===t?this.createConditionalBinding(e,i):"visible"===t?this.createVisibilityBinding(e,i):"value"===t?(this.setupInputElement(e,i),this.createInputBinding(e,i)):"checked"===t?"radio"===e.type?(console.warn('Radio buttons should use data-pac-bind="value:property", not "checked:property"'),this.setupInputElement(e,i),this.createInputBinding(e,i)):(this.setupInputElement(e,i,"checked"),this.createCheckedBinding(e,i)):a.isEventType(t)?this.createEventBinding(e,t,i):i?this.createAttributeBinding(e,t,i):null},createForeachBinding(e,t){const i=t.split(" then "),n=i[0].trim(),a=i[1]?i[1].trim():null;return this.createBinding("foreach",e,{target:n,collection:n,callback:a,itemName:e.getAttribute("data-pac-item")||"item",indexName:e.getAttribute("data-pac-index")||"index",template:e.innerHTML,previous:[]})},createConditionalBinding(e,t){return this.createBinding("conditional",e,{target:t,parsedExpression:null,dependencies:null,placeholder:null,originalParent:e.parentNode,originalNextSibling:e.nextSibling,isRendered:!0})},createVisibilityBinding(e,t){return this.createBinding("visible",e,{target:t,parsedExpression:null,dependencies:null})},createInputBinding(e,t){return this.createBinding("input",e,{target:t,updateMode:e.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay})},createCheckedBinding(e,t){return this.createBinding("checked",e,{target:t,updateMode:e.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay})},createEventBinding(e,t,i){return this.createBinding("event",e,{eventType:t,method:i,target:i})},createAttributeBinding(e,t,i){return this.createBinding("attribute",e,{target:i,attribute:t,parsedExpression:null,dependencies:null})},setupInputElement(e,t,i="value"){e.setAttribute("data-pac-property",t),e.setAttribute("data-pac-binding-type",i),e.setAttribute("data-pac-update-mode",e.getAttribute("data-pac-update")||this.config.updateMode),e.setAttribute("data-pac-update-delay",e.getAttribute("data-pac-delay")||this.config.delay)},shouldUpdateBinding(e,t){if(e.property===t)return!0;if(e.propertyPath&&e.propertyPath.startsWith(t+"."))return!0;if(e.target&&!e.dependencies){this.getParsedExpression(e)}return!(!e.dependencies||!e.dependencies.includes(t))},scheduleUpdate(e,t){this.pendingUpdates||(this.pendingUpdates=new Set,this.pendingValues={},(window.requestAnimationFrame||(e=>setTimeout(e,0)))((()=>{this.flushUpdates()}))),this.pendingUpdates.add(e),this.pendingValues[e]=t},flushUpdates(){if(!this.pendingUpdates)return;const e=new Set;this.pendingUpdates.forEach((t=>{(this.bindingIndex.get(t)||new Set).forEach((i=>{this.shouldUpdateBinding(i,t)&&e.add(i)})),this.unparsedBindings.forEach((i=>{i.parsedExpression||(this.getParsedExpression(i),this.unparsedBindings.delete(i)),this.shouldUpdateBinding(i,t)&&e.add(i)}))})),e.forEach((e=>{this.updateBinding(e,null,null)})),this.pendingUpdates=null,this.pendingValues=null},updateComputedProperties(e){(this.propertyDeps.get(e)||[]).forEach((e=>{const t=this.computedCache.get(e);this.computedCache.delete(e);const i=this.abstraction[e];!Array.from(this.bindings.values()).some((t=>"foreach"===t.type&&t.collection===e))&&a.isEqual(t,i)||(this.scheduleUpdate(e,i),this.notifyParent("propertyChange",{property:e,oldValue:t,newValue:i,computed:!0}),this.updateComputedProperties(e))}))},handleDeepChange(e,t,i,n){const r=a.splitPath(e)[0];if("nested-change"===i||"set"===i){const e=this.propertyDeps.get(r)||[];e.forEach((e=>{this.computedCache.delete(e)})),this.bindings.forEach((t=>{"foreach"===t.type&&(t.collection===r||e.includes(t.collection))&&(t.previous=null)}))}this.updateComputedProperties(r),this.scheduleUpdate(r,this.abstraction[r]);(this.propertyDeps.get(r)||[]).forEach((e=>{this.scheduleUpdate(e,this.abstraction[e])})),e!==r&&this.scheduleUpdate(e,t),this.notifyParent("propertyChange",{property:r,path:e,newValue:t,changeType:i,metadata:n})},performInitialUpdate(){Object.keys(this.abstraction).forEach((e=>{this.abstraction.hasOwnProperty(e)&&"function"!=typeof this.abstraction[e]&&this.scheduleUpdate(e,this.abstraction[e])})),this.original.computed&&Object.keys(this.original.computed).forEach((e=>{this.scheduleUpdate(e,this.abstraction[e])})),this.bindings.forEach((e=>{if("foreach"===e.type){e.previous=[];void 0!==this.abstraction[e.collection]&&this.updateForeachBinding(e,e.collection)}}))},updateBinding(e,t,i=null){try{switch(e.type){case"text":this.updateTextBinding(e,t,i);break;case"attribute":this.updateAttributeBinding(e,t,i);break;case"input":this.updateInputBinding(e,t,i);break;case"checked":this.updateCheckedBinding(e,t,i);break;case"visible":this.updateVisibilityBinding(e,t,i);break;case"conditional":this.updateConditionalBinding(e,t,i);break;case"foreach":this.updateForeachBinding(e,t,i);break;case"class":this.updateClassBinding(e,t,i)}}catch(t){console.error(`Error updating ${e.type} binding:`,t)}},updateTextBinding(e,t){const i=e.element;let n=e.originalText;const r=n.match(/\{\{\s*([^}]+)\s*\}\}/g);r&&r.forEach((e=>{const t=e.replace(/[{}\s]/g,""),i=o.parse(t),r=o.evaluate(i,this.abstraction),s=a.formatValue(r);n=n.replace(e,s)}));const s=`text_${e.id}`;this.lastValues.get(s)!==n&&(this.lastValues.set(s,n),i.textContent=n)},updateAttributeBinding(e,t,i=null){const n=Object.assign({},this.abstraction,i||{}),a=this.getParsedExpression(e),r=o.evaluate(a,n);this.setElementAttribute(e.element,e.attribute,r)},updateInputBinding(e,t,i=null){const n=e.element,a=Object.assign({},this.abstraction,i||{}),r=this.getParsedExpression(e);if("radio"===n.type){const e=o.evaluate(r,a);return void this.applyCheckedBinding(n,n.value===e)}const s=o.evaluate(r,a);n.value!==String(s||"")&&(n.value=s||"")},updateCheckedBinding(e,t,i=null){const n=Object.assign({},this.abstraction,i||{}),a=this.getParsedExpression(e),r=o.evaluate(a,n);this.applyCheckedBinding(e.element,Boolean(r))},updateVisibilityBinding(e,t,i=null){const n=Object.assign({},this.abstraction,i||{}),a=this.getParsedExpression(e),r=o.evaluate(a,n);this.applyVisibilityBinding(e.element,r)},updateConditionalBinding(e,t,i=null){const n=Object.assign({},this.abstraction,i||{}),a=this.getParsedExpression(e),r=o.evaluate(a,n);e.isRendered!==r&&(r?(e.placeholder&&e.placeholder.parentNode&&e.placeholder.parentNode.replaceChild(e.element,e.placeholder),e.isRendered=!0):(e.placeholder||(e.placeholder=document.createComment(`pac-if: ${e.target}`)),e.element.parentNode&&e.element.parentNode.replaceChild(e.placeholder,e.element),e.isRendered=!1))},updateForeachBinding(e,t,i=null){if(t&&e.collection!==t)return;const n=Object.assign({},this.abstraction,i||{}),r=this.getParsedExpression(e),s=o.evaluate(r,n),c=Array.isArray(s)?s:[],d=e.previous||[];if(!(null===e.previous)&&a.isEqual(d,c))return void(e.previous=[...c]);e.previous=[...c];const l=document.createDocumentFragment();c.forEach(((t,i)=>{const n=this.renderForeachItem(e.template,t,i,e.itemName,e.indexName,e.collection);l.appendChild(n)})),e.element.innerHTML="",e.element.appendChild(l),e.callback&&"function"==typeof this.abstraction[e.callback]&&setTimeout((()=>{this.abstraction[e.callback].call(this.abstraction,s,{element:e.element,previous:d,current:c,binding:e})}),0)},updateClassBinding(e,t,i=null){const n=Object.assign({},this.abstraction,i||{}),a=this.getParsedExpression(e),r=o.evaluate(a,n);this.applyClassBinding(e.element,e.target,r)},renderForeachItem(e,t,i,n,a,r){const s=document.createElement("div");s.innerHTML=e;const o=s.firstElementChild||s.firstChild;if(!o)return document.createTextNode("");const c=o.cloneNode(!0);return this.processForeachTemplate(c,t,i,n,a,r),c},processForeachTemplate(e,t,i,n,r,s){const o={[n]:t,[r]:i},c=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),d=[];let l;for(;l=c.nextNode();)d.push(l);d.forEach((e=>{e.textContent=e.textContent.replace(/\{\{\s*([^}]+)\s*\}\}/g,((e,s)=>(s=s.trim())===r?i:s===n?a.formatValue(t):s.startsWith(`${n}.`)?a.formatValue(a.getNestedValue(t,s.substring(n.length+1))):e))})),[e,...e.querySelectorAll("[data-pac-bind]")].forEach((e=>{const t=e.getAttribute("data-pac-bind");t&&t.split(",").forEach((t=>{const[a,r]=t.trim().split(":").map((e=>e.trim()));if(("value"===a||"checked"===a)&&r.startsWith(`${n}.`)){const t=r.substring(n.length+1);this.setupInputElement(e,`${s}.${i}.${t}`,a)}this.processForeachBinding(e,a,r,o)}))}))},processForeachBinding(e,t,i,n){if(a.isEventType(t))return void this.handleEventBinding(e,t,i,n[Object.keys(n)[0]],n[Object.keys(n)[1]]);const r=this.createForeachEvaluationBinding(e,t,i);this.updateBinding(r,null,n)},createForeachEvaluationBinding(e,t,i){const n={visible:"visible",checked:"checked",value:"input",class:"class"}[t]||"attribute";return{id:`foreach_eval_${a.generateId()}`,type:n,element:e,target:i,attribute:"attribute"===n?t:null,parsedExpression:null,dependencies:null}},setupEventHandling(){const e=e=>{this.handleEvent(e)};i.forEach((t=>{this.container.addEventListener(t,e,!0),this.eventListeners.set(t,e)}))},handleEvent(e){const{type:t,target:i}=e,n=i.getAttribute("data-pac-property");"input"!==t&&"change"!==t||!n||this.handleInputEvent(e,i,n),this.handleCustomEvent(e,t,i)},handleInputEvent(e,t,i){const n=t.getAttribute("data-pac-update-mode")||this.config.updateMode,a=(t.getAttribute("data-pac-binding-type"),this.readDOMValue(t));switch(n){case"immediate":this.setNestedProperty(i,a);break;case"delayed":this.handleDelayedUpdate(t,i,a);break;case"change":"change"===e.type&&this.setNestedProperty(i,a)}},handleCustomEvent(e,t,i){let n=i;if("submit"===t&&"FORM"!==i.tagName&&(n=i.closest("form"),!n))return;const a=this.parseEventModifiers(i);this.applyEventModifiers(e,a)&&this.bindings.forEach((n=>{if("event"===n.type&&n.eventType===t&&n.element===i){const t=this.abstraction[n.method];if("function"==typeof t)try{t.call(this.abstraction,e)}catch(e){console.error(`Error executing event handler '${n.method}':`,e)}}}))},handleEventBinding(e,t,i,n,a){e.addEventListener(t,(e=>{const t=this.abstraction[i];"function"==typeof t?t.call(this.abstraction,n,a,e):console.warn(`Event handler "${i}" is not a function`)}))},parseEventModifiers(e){const t=e.getAttribute("data-pac-modifiers");return t?t.trim().split(/\s+/).filter((e=>e.length>0)):[]},applyEventModifiers(e,t){for(const i of t){const t=n[i.toLowerCase()];if(t){if(Array.isArray(t)){if(!t.includes(e.key))return!1}else if(e.key!==t)return!1;break}}return!0},handleDelayedUpdate(e,t,i){const n=parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay,a=`delayed_${t}`;this.updateTimeouts.has(a)&&clearTimeout(this.updateTimeouts.get(a));const r=setTimeout((()=>{this.abstraction[t]=i,this.updateTimeouts.delete(a)}),n);this.updateTimeouts.set(a,r)},setElementAttribute(e,i,n){switch(i){case"class":e.className=n||"";break;case"style":"object"==typeof n&&n?Object.assign(e.style,n):e.style.cssText=n||"";break;case"enable":n?e.removeAttribute("disabled"):e.setAttribute("disabled","disabled");break;default:t.includes(i)?n?e.setAttribute(i,i):e.removeAttribute(i):null!=n?e.setAttribute(i,n):e.removeAttribute(i)}},setNestedProperty(e,t){const i=e.split(".");if(1===i.length)return void(this.abstraction[e]=t);let n=this.abstraction;for(let t=0;t<i.length-1;t++)if(n=n[i[t]],!n)return void console.warn(`Cannot set property: ${e} - path not found at '${i.slice(0,t+1).join(".")}'`);n[i[i.length-1]]=t},applyVisibilityBinding(e,t){if(t)e.hasAttribute("data-pac-hidden")&&(e.style.display=e.getAttribute("data-pac-orig-display")||"",e.removeAttribute("data-pac-hidden"),e.removeAttribute("data-pac-orig-display"));else if(!e.hasAttribute("data-pac-hidden")){const t=getComputedStyle(e).display;"none"!==t&&e.setAttribute("data-pac-orig-display",t),e.style.display="none",e.setAttribute("data-pac-hidden","true")}},applyCheckedBinding(e,t){e.checked=t},applyClassBinding(e,t,i){const n=t.includes(".")?t.split(".").pop():t;i?e.classList.add(n):e.classList.remove(n)},readDOMValue:e=>{let t;if("string"==typeof e?t=e.startsWith("#")?document.getElementById(e.slice(1)):document.querySelector(e):e&&e.nodeType&&(t=e),!t)return console.warn(`Element not found: ${e}`),!1;switch(!0){case"SELECT"===t.tagName:return t.value;case"checkbox"===t.type:return t.checked;case"radio"===t.type:const e=document.querySelector(`input[name="${t.name}"]:checked`);return e?e.value:"";case"INPUT"===t.tagName||"TEXTAREA"===t.tagName:return t.value;default:return t.textContent||t.innerText}},establishHierarchy(){const{parent:e,children:t}=window.PACRegistry.getHierarchy(this.container);e&&this.parent!==e&&(this.parent=e,e.children.add(this)),t.forEach((e=>{e.parent!==this&&(e.parent&&e.parent.children.delete(e),e.parent=this,this.children.add(e))}))},notifyParent(e,t){this.parent&&"function"==typeof this.parent.receiveUpdate&&this.parent.receiveUpdate(e,t,this)},receiveUpdate(e,t,i){this.abstraction.onChildUpdate&&this.abstraction.onChildUpdate(e,t,i),this.container.dispatchEvent(new CustomEvent("pac:childupdate",{detail:{eventType:e,data:t,childPAC:i},bubbles:!0}))},receiveFromParent(e,t){this.abstraction.receiveFromParent&&this.abstraction.receiveFromParent(e,t),this.container.dispatchEvent(new CustomEvent("pac:parentcommand",{detail:{command:e,data:t},bubbles:!0}))},sendToChildren(e,t){this.children.forEach((i=>{"function"==typeof i.receiveFromParent&&i.receiveFromParent(e,t)}))},sendToChild(e,t,i){const n=Array.from(this.children).find((t=>t.container.matches(e)));n&&n.receiveFromParent&&n.receiveFromParent(t,i)},makeHttpRequest(e,t={}){return fetch(e,{method:t.method||"GET",headers:Object.assign({"Content-Type":"application/json","X-PAC-Request":"true"},t.headers||{}),body:t.data?JSON.stringify(t.data):void 0}).then((e=>e.json())).then((e=>(t.onSuccess&&t.onSuccess.call(this.abstraction,e),e))).catch((e=>{throw t.onError&&t.onError.call(this.abstraction,e),e}))},serializeToJSON(){const e={},t=this.original.computed?Object.keys(this.original.computed):[],i=["notifyParent","sendToChildren","sendToChild","findChild","toJSON"];return Object.keys(this.abstraction).forEach((n=>{const a=this.abstraction[n];void 0===a||"function"==typeof a||t.includes(n)||i.includes(n)||(e[n]=a)})),e},destroy(){this._clearTimeouts(),this._clearCaches(),this._unregisterFromGlobalRegistry(),this._clearBindings(),this._cleanupHierarchy(),this._removeEventListeners(),this._nullifyReferences()},_clearTimeouts(){this.updateTimeouts.forEach((e=>clearTimeout(e))),this.updateTimeouts.clear()},_clearCaches(){this.computedCache.clear(),this.expressionCache.clear(),this.lastValues.clear()},_unregisterFromGlobalRegistry(){window.PACRegistry.unregister(e)},_clearBindings(){this.bindings.clear(),this.bindingIndex.clear()},_cleanupHierarchy(){this.parent&&(this.parent.children.delete(this),this.parent=null),this.children.forEach((e=>{e.parent=null})),this.children.clear()},_removeEventListeners(){this.eventListeners.forEach(((e,t)=>{this.container.removeEventListener(t,e,!0)})),this.eventListeners.clear()},_nullifyReferences(){this.abstraction=null,this.container=null}};const p=function(e){const t={};return Object.keys(e.abstraction).forEach((i=>{const n=Object.getOwnPropertyDescriptor(e.abstraction,i);n&&Object.defineProperty(t,i,n)})),Object.assign(t,{addChild:e=>{l.children.add(e),e.parent=l},removeChild:e=>{l.children.delete(e),e.parent=null},notifyParent:(e,t)=>l.notifyParent(e,t),receiveUpdate:(e,t,i)=>l.receiveUpdate(e,t,i),receiveFromParent:(e,t)=>l.receiveFromParent(e,t),sendToChildren:(e,t)=>l.sendToChildren(e,t),sendToChild:(e,t,i)=>l.sendToChild(e,t,i),findChild:e=>Array.from(l.children).find(e),findChildren:e=>Array.from(l.children).filter(e),findChildBySelector:e=>Array.from(l.children).find((t=>t.container.matches(e))),findChildByProperty:(e,t)=>Array.from(l.children).find((i=>i.abstraction&&i.abstraction[e]===t)),control:(e,t={})=>l.makeHttpRequest(e,t),readDOMValue:e=>l.readDOMValue(e),destroy:()=>l.destroy()}),Object.defineProperties(t,{parent:{get:()=>l.parent,enumerable:!0},children:{get:()=>Array.from(l.children),enumerable:!0},container:{get:()=>l.container,enumerable:!0}}),t}(l.initialize());return window.PACRegistry.register(e,l),l.establishHierarchy(),window.PACRegistry.components.forEach((e=>{e===l||e.parent||e.establishHierarchy()})),p}window.PACRegistry=window.PACRegistry||new r,window.wakaPAC=c,"undefined"!=typeof module&&module.exports&&(module.exports={wakaPAC:c,ComponentRegistry:r,Utils:a})}();