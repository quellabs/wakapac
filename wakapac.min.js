!function(){"use strict";const e={PROXY:"undefined"!=typeof Proxy,isReactive:e=>e&&"object"==typeof e&&!e.nodeType&&!(e instanceof Date)&&!(e instanceof RegExp)&&!(e instanceof File),deepEq:(t,i)=>{if(t===i)return!0;if(!t||!i||typeof t!=typeof i||"object"!=typeof t)return!1;if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(!e.deepEq(t[r],i[r]))return!1;return!0}const r=Object.keys(t),n=Object.keys(i);if(r.length!==n.length)return!1;for(let n=0;n<r.length;n++){const s=r[n];if(!i.hasOwnProperty(s)||!e.deepEq(t[s],i[s]))return!1}return!0},id:()=>Date.now()+"_"+(1e4*Math.random()|0),isEvent:e=>/^(click|submit|change|input|focus|blur|key(up|down))$/.test(e)};function t(){this.units=new Map,this.cache=new WeakMap}function i(t,r,n=""){return e.isReactive(t)?e.PROXY?function(t,r,n){Object.keys(t).forEach((s=>{t.hasOwnProperty(s)&&e.isReactive(t[s])&&(t[s]=i(t[s],r,n?`${n}.${s}`:s))}));const s={},a=Array.isArray(t);a&&["push","pop","shift","unshift","splice","sort","reverse"].forEach((e=>{s[e]=t[e]}));return new Proxy(t,{get:(t,o)=>a&&s[o]?function(...a){const c=s[o].apply(t,a);return/^(push|unshift|splice)$/.test(o)&&t.forEach(((s,a)=>{e.isReactive(s)&&!s._reactive&&(t[a]=i(s,r,`${n}.${a}`))})),r(n||"root",t,"array-mutation",{method:o,args:a}),c}:t[o],set(t,s,a){const o=t[s];if(e.isReactive(a)&&(a=i(a,r,n?`${n}.${s}`:s)),t[s]=a,!e.deepEq(o,a)&&(r(n?`${n}.${s}`:s,a,"set",{old:o}),n&&n.includes("."))){const e=this.splitPath(n)[0];r(e,null,"nested-property-change",{nestedPath:n?`${n}.${s}`:s,oldValue:o,newValue:a})}return!0},deleteProperty(e,t){const i=e[t];return delete e[t],r(n?`${n}.${t}`:t,void 0,"delete",{old:i}),!0}})}(t,r,n):function(t,r,n){Array.isArray(t)&&["push","pop","shift","unshift","splice","sort","reverse"].forEach((e=>{const i=t[e];Object.defineProperty(t,e,{value:function(...t){const s=i.apply(this,t);return r(n||"root",this,"array-mutation",{method:e,args:t}),s},enumerable:!1,configurable:!0})}));return Object.keys(t).forEach((s=>{t.hasOwnProperty(s)&&e.isReactive(t[s])&&(t[s]=i(t[s],r,n?`${n}.${s}`:s))})),Object.defineProperty(t,"_reactive",{value:!0,enumerable:!1}),t}(t,r,n):t}function r(t,r={},n={}){const s=document.querySelector(t);if(!s)throw new Error(`Container not found: ${t}`);const a=Object.assign({updateMode:"immediate",delay:300,deepReactivity:!0},n),o={bindings:new Map,abstraction:null,delays:new Map,parent:null,children:new Set,listeners:new Map,pending:null,pendingVals:null,pendingPaths:null,orig:r,computedCache:new Map,computedDeps:new Map,propDeps:new Map,expressionCache:new Map,pathSplitCache:new Map,lastValues:new Map,container:s,config:a,splitPath(e){return this.pathSplitCache.has(e)||(-1===e.indexOf("[")&&-1===e.indexOf("'")&&-1===e.indexOf('"')?this.pathSplitCache.set(e,e.split(".")):this.pathSplitCache.set(e,this.parsePropertyPath(e))),this.pathSplitCache.get(e)},createBinding(e,t,i){const r={type:e,element:t,...i};return i.target&&(r.property=this.splitPath(i.target)[0],r.propertyPath=i.target),r},shouldUpdateBinding(e,t){if(t.includes(".")){if(e.propertyPath===t)return!0;if(e.propertyPath&&e.propertyPath.startsWith(t+"."))return!0;const i=this.splitPath(t)[0];return e.property===i&&(e.propertyPath&&(e.propertyPath===t||e.propertyPath.startsWith(t+".")))}return e.property===t||(!(!e.propertyPath||!e.propertyPath.startsWith(t+"."))||(!(!e.dependencies||!e.dependencies.includes(t))||!(!e.parsedExpression||!e.parsedExpression.dependencies?.includes(t))))},updateBinding(e,t,i){const r=this.shouldUpdateBinding(e,t);if(!r&&"foreach"!==e.type)return;const n={text:()=>this.updateText(e,t,i),attribute:()=>this.updateAttribute(e,t,i),input:()=>this.updateInput(e,t,i),checked:()=>this.updateChecked(e,t,i),visible:()=>this.updateVisible(e,i),foreach:()=>this.updateForeach(e,t,i)}[e.type];n&&(r||"foreach"===e.type)&&n.call(this)},parseExpression(e){const t=(e=e.trim()).match(/^(.+?)\s*\?\s*(.+?)\s*:\s*(.+?)$/);if(t){const[,e,i,r]=t;return{type:"ternary",condition:e.trim(),trueValue:this.parseValue(i.trim()),falseValue:this.parseValue(r.trim()),dependencies:this.extractDependencies(e.trim())}}const i=e.match(/^(.+?)\s*(===|!==|==|!=|>=|<=|>|<)\s*(.+?)$/);if(i){const[,e,t,r]=i;return{type:"comparison",left:e.trim(),operator:t.trim(),right:this.parseValue(r.trim()),dependencies:this.extractDependencies(e.trim())}}const r=e.match(/^(.+?)\s*(&&|\|\|)\s*(.+?)$/);if(r){const[,e,t,i]=r;return{type:"logical",left:e.trim(),operator:t.trim(),right:i.trim(),dependencies:[...this.extractDependencies(e.trim()),...this.extractDependencies(i.trim())]}}return{type:"property",path:e,dependencies:this.extractDependencies(e)}},parseValue:e=>(e=e.trim()).startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?{type:"literal",value:e.slice(1,-1)}:/^\d+(\.\d+)?$/.test(e)?{type:"literal",value:parseFloat(e)}:"true"===e||"false"===e?{type:"literal",value:"true"===e}:{type:"property",path:e},extractDependencies(e){const t=[],i=["true","false","null","undefined","NaN","Infinity"],r=/\b([a-zA-Z_$][a-zA-Z0-9_$]*)(?:\.[a-zA-Z_$][a-zA-Z0-9_$]*|\[[^\]]+])*/g;let n;for(;n=r.exec(e);){n[0];const e=n[1];i.includes(e)||t.includes(e)||t.push(e)}return t},evaluateExpression(e,t=!1){let i;switch(e.type){case"ternary":i=this.evaluateExpression(e.condition,!0)?this.evaluateValue(e.trueValue):this.evaluateValue(e.falseValue);break;case"comparison":const t=this.resolvePropertyPath(e.left),r=this.evaluateValue(e.right);i=this.evaluateComparison(t,e.operator,r);break;case"logical":const n=this.evaluateExpression(e.left,!0),s=this.evaluateExpression(e.right,!0);i="&&"===e.operator?n&&s:"||"===e.operator&&(n||s);break;case"property":i=this.resolvePropertyPath(e.path);break;default:i=void 0}return t?Boolean(i):i},evaluateComparison(e,t,i){switch(t){case"===":return e===i;case"!==":return e!==i;case"==":return e==i;case"!=":return e!=i;case">=":return e>=i;case"<=":return e<=i;case">":return e>i;case"<":return e<i;default:return!1}},evaluateValue(e){return"literal"===e.type?e.value:"property"===e.type?this.resolvePropertyPath(e.path):void 0},renderItem(e,t,i,r,n){const s=document.createElement("div");s.innerHTML=e;const a=s.firstElementChild||s.firstChild;if(!a)return document.createTextNode("");const o=a.cloneNode(!0);return this.processTemplate(o,t,i,r,n),o},processTemplate(e,t,i,r,n){const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),a=[];let o;for(;o=s.nextNode();)a.push(o);a.forEach((e=>{let s=e.textContent;s=s.replace(new RegExp(`\\{\\{\\s*${r}\\.(\\w+)\\s*\\}\\}`,"g"),((e,i)=>t&&t.hasOwnProperty(i)?t[i]:"")),s=s.replace(new RegExp(`\\{\\{\\s*${r}\\s*\\}\\}`,"g"),(()=>"object"==typeof t?JSON.stringify(t):t||"")),s=s.replace(new RegExp(`\\{\\{\\s*${n}\\s*\\}\\}`,"g"),(()=>i)),e.textContent=s})),[e,...e.querySelectorAll("[data-pac-bind]")].forEach((e=>{const s=e.getAttribute("data-pac-bind");s&&s.split(",").forEach((s=>{const[a,o]=s.trim().split(":").map((e=>e.trim()));this.processBinding(e,a,o,t,i,r,n)}))}))},processBinding(t,i,r,n,s,a,o){const c={class:()=>{if(this.evalExpr(r,n,s,a,o)){const e=r.includes(".")?this.splitPath(r).pop():r;t.classList.add(e)}},checked:()=>{t.checked=!!this.evalExpr(r,n,s,a,o)}};if(c[i])c[i]();else if(e.isEvent(i))t.addEventListener(i,(e=>{"function"==typeof this.abstraction[r]&&this.abstraction[r].call(this.abstraction,n,s,e)}));else{const e=this.evalExpr(r,n,s,a,o);null!=e&&t.setAttribute(i,e)}},evalExpr:(e,t,i,r,n)=>e===n?i:e===r?t:e.startsWith(`${r}.`)?e.substring(r.length+1).split(".").reduce(((e,t)=>e&&e.hasOwnProperty(t)?e[t]:void 0),t):e,arrEq:(t,i)=>t.length===i.length&&t.every(((t,r)=>e.deepEq(t,i[r]))),handleDeepChange(e,t,i,r){const n=this.splitPath(e)[0];if("nested-property-change"===i||"set"===i&&e.includes(".")){let t=!1;const r=this.propDeps.get(n)||[];this.bindings.forEach(((s,a)=>{"foreach"===s.type&&(s.collection===n||r.includes(s.collection))&&("array-mutation"===i||s.collection===n||this.pathAffectsCollection(e,s.collection))&&(s.prev=null,t=!0)}))}this.updateComputed(n),("array-mutation"===i||"nested-property-change"===i||"set"===i||this.abstraction.hasOwnProperty(n))&&(this.updateDOM(n,this.abstraction[n]),e!==n&&"set"===i&&this.updateDOM(e,t)),this.notifyParent("propertyChange",{property:n,path:e,newValue:t})},pathAffectsCollection(e,t){const i=this.splitPath(e),r=this.splitPath(t);return i[0]===r[0]},updateDOM(e,t){if(!this.pending){this.pending=new Set,this.pendingVals={},this.pendingPaths=new Set;const e=this;(window.requestAnimationFrame||(e=>setTimeout(e,0)))((()=>{e.flushDOM()}))}if(e.includes(".")){this.pendingPaths.add(e),this.pendingVals[e]=t;const i=this.splitPath(e)[0];this.pending.add(i),this.pendingVals.hasOwnProperty(i)||(this.pendingVals[i]=this.abstraction[i])}else this.pending.add(e),this.pendingVals[e]=t},flushDOM(){this.pending&&(this.pendingPaths&&this.pendingPaths.forEach((e=>{this.bindings.forEach((t=>this.updateBinding(t,e,this.pendingVals[e])))})),this.pending.forEach((e=>{this.bindings.forEach((t=>this.updateBinding(t,e,this.pendingVals[e])))})),this.pending=null,this.pendingVals=null,this.pendingPaths=null)},resolveBindingValue(e,t){return e.propertyPath&&e.propertyPath!==e.property?this.resolvePropertyPath(e.propertyPath):t},setElementAttribute(e,t,i){["disabled","readonly","required","selected","checked","hidden","multiple"].includes(t)?i?e.setAttribute(t,t):e.removeAttribute(t):null!=i?e.setAttribute(t,i):e.removeAttribute(t)},updateElementProperty(e,t,i){e[t]!==i&&(e[t]=i)},updateText(e,t,i){if(!this.shouldUpdateBinding(e,t))return;const r=e.textNode||e.element,n=this.updateTextGetAffectedBindings(r),s=this.updateTextProcessBindings(e.origText,n);this.updateTextNodeIfChanged(r,n,s)},updateTextGetAffectedBindings(e){const t=[];return this.bindings.forEach((i=>{"text"!==i.type||i.textNode!==e&&i.element!==e||t.push(i)})),t},updateTextProcessBindings(e,t){let i=e;return t.forEach((e=>{let t;t=e.parsedExpression&&e.expressionContent?this.evaluateExpression(e.parsedExpression):this.resolvePropertyPath(e.propertyPath||e.property);const r=this.formatDisplayValue(t),n=e.fullMatch.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");i=i.replace(new RegExp(n,"g"),r)})),i},updateTextNodeIfChanged(e,t,i){const r=`text_node_${e.parentElement?.tagName||"root"}_${t.map((e=>e.property)).join("_")}`;this.lastValues.get(r)!==i&&(this.lastValues.set(r,i),e.textContent=i)},updateAttribute(e,t,i){let r;r=e.parsedExpression&&"ternary"===e.parsedExpression.type?this.evaluateExpression(e.parsedExpression):e.parsedExpression&&"property"===e.parsedExpression.type?this.resolvePropertyPath(e.parsedExpression.path):this.resolveBindingValue(e,i),this.applyAttributeValue(e.element,e.attribute,r)},applyAttributeValue(e,t,i){switch(t){case"class":e.className=i||"";break;case"style":"object"==typeof i&&i?Object.assign(e.style,i):"string"==typeof i&&(e.style.cssText=i||"");break;default:this.setElementAttribute(e,t,i)}},updateInput(e,t,i){if(this.shouldUpdateBinding(e,t)){const t=this.resolveBindingValue(e,i);this.updateElementProperty(e.element,"value",t)}},updateChecked(e,t,i){if(this.shouldUpdateBinding(e,t)){const t=this.resolveBindingValue(e,i);this.updateElementProperty(e.element,"checked",!!t)}},updateVisible(e,t){const i=this.resolveBindingValue(e,t),r=e.isNegated?!i:!!i;this.toggleElementVisibility(e.element,r)},updateForeach(e,t,i){if(e.collection!==t)return;const r=Array.isArray(i)?i:[],n=e.prev||[];if(this.arrEq(n,r))return void(e.prev=[...r]);e.prev=[...r];const s=document.createDocumentFragment();r.forEach(((t,i)=>{const r=this.renderItem(e.template,t,i,e.itemName,e.indexName);s.appendChild(r)})),e.element.innerHTML="",e.element.appendChild(s)},formatDisplayValue:e=>"object"==typeof e&&null!==e?Array.isArray(e)?`[${e.length} items]`:JSON.stringify(e,null,2):null==e?"":e,toggleElementVisibility(e,t){if(t)e.hasAttribute("data-pac-hidden")&&(e.style.display=e.getAttribute("data-pac-orig-display")||"",e.removeAttribute("data-pac-hidden"),e.removeAttribute("data-pac-orig-display"));else if(!e.hasAttribute("data-pac-hidden")){const t=getComputedStyle(e).display;"none"!==t&&e.setAttribute("data-pac-orig-display",t),e.style.display="none",e.setAttribute("data-pac-hidden","true")}},resolvePropertyPath(e){if(!e||"string"!=typeof e)return void console.warn("resolvePropertyPath: Invalid path provided:",e);return this.parsePropertyPath(e).reduce(((e,t)=>{if(null!=e){if("property"===t.type)return e[t.name];if("index"===t.type){const i=parseInt(t.value,10);return Array.isArray(e)?e[i]:void 0}return"key"===t.type?e[t.value]:void 0}}),this.abstraction)},parsePropertyPath(e){const t=[];let i="",r=0;for(;r<e.length;){const n=e[r];if("."===n)i&&(t.push({type:"property",name:i}),i=""),r++;else if("["===n){i&&(t.push({type:"property",name:i}),i=""),++r;let n="",s=!1,a="";for(;r<e.length&&("]"!==e[r]||s);){const t=e[r];'"'!==t&&"'"!==t||s?t===a&&s?(s=!1,a=""):n+=t:(s=!0,a=t),r++}n&&(/^\d+$/.test(n)?t.push({type:"index",value:n}):t.push({type:"key",value:n})),r++}else i+=n,r++}return i&&t.push({type:"property",name:i}),t},analyzeComputed(e){if(!e||"function"!=typeof e)return[];try{const t=[],i=/this\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g;let r;for(;r=i.exec(e.toString());){const e=r[1];!this.orig.hasOwnProperty(e)||this.orig.computed&&this.orig.computed.hasOwnProperty(e)||t.includes(e)||t.push(e)}return t}catch(e){return console.error("Error analyzing computed function:",e),[]}},updateComputed(t){(this.propDeps.get(t)||[]).forEach((t=>{const i=this.computedCache.get(t);if(!this.orig.computed)return;const r=this.orig.computed[t];if(r&&"function"==typeof r)try{const n=r.call(this.abstraction);!Array.from(this.bindings.values()).some((e=>"foreach"===e.type&&e.collection===t))&&e.deepEq(i,n)||(this.computedCache.set(t,n),this.updateDOM(t,n),this.notifyParent("propertyChange",{property:t,oldValue:i,newValue:n,computed:!0}),this.updateComputed(t))}catch(e){console.error(`Error executing computed property '${t}':`,e)}}))},createReactiveAbs(){const e={};return this.setupComputedProperties(e),Object.keys(this.orig).forEach((t=>{if(this.orig.hasOwnProperty(t)&&"computed"!==t){const i=this.orig[t];"function"==typeof i?e[t]=i:this.createReactiveProp(e,t,i)}})),Object.assign(e,{notifyParent:(e,t)=>this.notifyParent(e,t),sendToChildren:(e,t)=>this.sendToChildren(e,t),sendToChild:(e,t,i)=>{const r=Array.from(this.children).find((t=>t.container.matches(e)));r&&r.receiveFromParent&&r.receiveFromParent(t,i)},findChild:e=>Array.from(this.children).find(e),toJSON:()=>{const e={},t=o.orig.computed?Object.keys(o.orig.computed):[];return Object.keys(o.abstraction).forEach((i=>{const r=o.abstraction[i];void 0===r||"function"==typeof r||t.includes(i)||["notifyParent","sendToChildren","sendToChild","findChild","toJSON"].includes(i)||(e[i]=r)})),e}}),e},setupComputedProperties(e){this.orig.computed&&Object.keys(this.orig.computed).forEach((t=>{const i=this.orig.computed[t];let r,n;if("function"==typeof i)r=i,n=null;else{if(!i||"object"!=typeof i)return void console.error(`Invalid computed property definition for '${t}'`);if(r=i.get,n=i.set,"function"!=typeof r)return void console.error(`Computed property '${t}' must have a getter function`)}try{const i=this.analyzeComputed(r);this.computedDeps.set(t,i),i.forEach((e=>{this.propDeps.has(e)||this.propDeps.set(e,[]);const i=this.propDeps.get(e);i.includes(t)||i.push(t)}));const s={get:()=>{try{const i=r.toString();if(/this\.children|this\.findChild|Array\.from\(this\.children\)/.test(i)){const i=r.call(e);return this.computedCache.set(t,i),i}{if(this.computedCache.has(t))return this.computedCache.get(t);const i=r.call(e);return this.computedCache.set(t,i),i}}catch(e){return void console.error(`Error computing property '${t}':`,e)}},enumerable:!0};n&&"function"==typeof n&&(s.set=i=>{try{this.computedCache.delete(t),n.call(e,i),this.computedCache.delete(t),this.updateDOM(t,e[t])}catch(e){console.error(`Error setting computed property '${t}':`,e)}}),Object.defineProperty(e,t,s)}catch(e){console.error(`Error setting up computed property '${t}':`,e)}}))},createReactiveProp(t,r,n){let s=n;this.config.deepReactivity&&e.isReactive(s)&&(s=i(s,((e,t,i,r)=>this.handleDeepChange(e,t,i,r)),r)),Object.defineProperty(t,r,{get:()=>s,set:t=>{if(e.isReactive(s)||e.isReactive(t)||!e.deepEq(s,t)){const n=s;this.config.deepReactivity&&e.isReactive(t)&&(t=i(t,((e,t,i,r)=>this.handleDeepChange(e,t,i,r)),r)),s=t,this.updateDOM(r,t),this.updateComputed(r),this.notifyParent("propertyChange",{property:r,oldValue:n,newValue:t})}},enumerable:!0})},setupBindings(){this.findTextBindings(),this.findAttrBindings()},findTextBindings(){const t=document.createTreeWalker(this.container,NodeFilter.SHOW_TEXT),i=[];let r;for(;r=t.nextNode();){const t=r.textContent,n=t.match(/\{\{\s*([^}]+)\s*\}\}/g);n&&n.forEach((n=>{const s=n.replace(/[{}\s]/g,"").trim();let a;this.expressionCache.has(s)?a=this.expressionCache.get(s):(a=this.parseExpression(s),this.expressionCache.set(s,a));(a.dependencies||[s.split(".")[0]]).forEach((o=>{const c=this.splitPath(o)[0];i.push([e.id(),{type:"text",property:c,propertyPath:o,expressionContent:s,parsedExpression:a,element:r.parentElement,origText:t,textNode:r,fullMatch:n}])}))}))}i.forEach((([e,t])=>this.bindings.set(e,t)))},findAttrBindings(){const t=this.container.querySelectorAll('[data-pac-bind]:not([data-pac-bind*="foreach"] [data-pac-bind])'),i=[];Array.from(t).forEach((t=>{t.getAttribute("data-pac-bind").split(",").forEach((r=>{const[n,s]=r.trim().split(":").map((e=>e.trim())),a=r+"_"+e.id(),o={foreach:()=>this.createForeachBinding(t,s),visible:()=>this.createVisibilityBinding(t,s),value:()=>(this.setupInput(t,s),this.createInputBinding(t,s)),checked:()=>(this.setupInput(t,s,"checked"),this.createCheckedBinding(t,s))};o[n]?(i.push([a,o[n]()]),"foreach"===n&&(t.innerHTML="")):e.isEvent(n)?i.push([a,this.createEventBinding(t,n,s)]):r.includes(":")&&s?i.push([a,this.createAttributeBinding.call(this,t,n,s)]):r.includes(":")||console.error(`Invalid binding syntax: "${r}". Use "type:target" format.`)}))})),i.forEach((([e,t])=>this.bindings.set(e,t)))},createForeachBinding(e,t){return this.createBinding("foreach",e,{target:t,collection:t,itemName:e.getAttribute("data-pac-item")||"item",indexName:e.getAttribute("data-pac-index")||"index",template:e.innerHTML})},createEventBinding(e,t,i){return this.createBinding("event",e,{event:t,method:i})},createVisibilityBinding(e,t){const i=t.startsWith("!"),r=t.replace(/^!/,"");return this.createBinding("visible",e,{target:r,condition:t,isNegated:i})},createAttributeBinding(e,t,i){if(this.expressionCache.has(i)){const r=this.expressionCache.get(i);return this.createBinding("attribute",e,{target:i,attribute:t,parsedExpression:r,dependencies:r.dependencies||[i.split(".")[0]]})}const r=this.parseExpression(i);return this.expressionCache.set(i,r),this.createBinding("attribute",e,{target:i,attribute:t,parsedExpression:r,dependencies:r.dependencies||[i.split(".")[0]]})},createInputBinding(e,t){return this.createBinding("input",e,{target:t,updateMode:e.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay})},createCheckedBinding(e,t){return this.createBinding("checked",e,{target:t,updateMode:e.getAttribute("data-pac-update-mode")||this.config.updateMode,delay:parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay})},setupInput(e,t,i="value"){e.setAttribute("data-pac-property",t),e.setAttribute("data-pac-binding-type",i),e.setAttribute("data-pac-update-mode",e.getAttribute("data-pac-update")||this.config.updateMode),e.setAttribute("data-pac-update-delay",e.getAttribute("data-pac-delay")||this.config.delay)},setupEvents(){const e=e=>{const{type:t,target:i}=e;(i.hasAttribute("data-pac-bind")||i.hasAttribute("data-pac-property"))&&this.handleEvent(e)};["input","change","click","submit","focus","blur","keyup","keydown"].forEach((t=>{this.container.addEventListener(t,e,!0),this.listeners.set(t,{handler:e,options:!0})}))},handleEvent(e){const{type:t,target:i}=e,r=i.getAttribute("data-pac-property"),n={input:()=>r&&this.abstraction.hasOwnProperty(r)&&this._handleInputEvent(e,i,r),change:()=>r&&this.abstraction.hasOwnProperty(r)&&this._handleChangeEvent(e,i,r),default:()=>this._handleEventBinding(e,t,i)};(n[t]||n.default)()},_handleInputEvent(e,t,i){const r=t.getAttribute("data-pac-update-mode")||this.config.updateMode,n="checked"===(t.getAttribute("data-pac-binding-type")||"value")?t.checked:t.value,s={change:()=>t.setAttribute("data-pac-pending-value",n),immediate:()=>this.abstraction[i]=n,delayed:()=>this.updateFromDOM(t,i,n),default:()=>{console.warn(`Unknown update mode: ${r}. Using immediate.`),this.abstraction[i]=n}};(s[r]||s.default)()},_handleChangeEvent(e,t,i){const r=`${i}_${t.getAttribute("data-pac-property")}`,n=t.getAttribute("data-pac-binding-type")||"value";this.delays.has(r)&&(clearTimeout(this.delays.get(r)),this.delays.delete(r)),this.abstraction[i]="checked"===n?t.checked:t.value,t.removeAttribute("data-pac-pending-value")},_handleEventBinding(e,t,i){const r=this.parseEventModifiers(i);this.applyEventModifiers(e,r,i)&&this.bindings.forEach((n=>{if("event"===n.type&&n.event===t&&n.element===i){const t=this.abstraction[n.method];if("function"!=typeof t)return void console.warn(`Event handler method '${n.method}' is not a function`);r.includes("once")&&(this.bindings.delete(n),i.removeAttribute("data-pac-modifiers"));try{t.call(this.abstraction,e)}catch(e){console.error(`Error executing event handler '${n.method}':`,e)}}}))},parseEventModifiers(e){const t=e.getAttribute("data-pac-modifiers");return t?t.trim().split(/\s+/).filter((e=>e.length>0)):[]},applyEventModifiers(e,t,i){for(const i of t)switch(i.toLowerCase()){case"prevent":e.preventDefault();break;case"stop":e.stopPropagation();break;case"passive":case"once":break;case"enter":if("Enter"!==e.key)return!1;break;case"escape":case"esc":if("Escape"!==e.key)return!1;break;case"space":if(" "!==e.key)return!1;break;case"tab":if("Tab"!==e.key)return!1;break;case"delete":case"del":if("Delete"!==e.key&&"Backspace"!==e.key)return!1;break;case"up":if("ArrowUp"!==e.key)return!1;break;case"down":if("ArrowDown"!==e.key)return!1;break;case"left":if("ArrowLeft"!==e.key)return!1;break;case"right":if("ArrowRight"!==e.key)return!1;break;case"ctrl":if(!e.ctrlKey)return!1;break;case"alt":if(!e.altKey)return!1;break;case"shift":if(!e.shiftKey)return!1;break;case"meta":if(!e.metaKey)return!1;break;default:e.key.toLowerCase()!==i.toLowerCase()&&console.warn(`Unknown event modifier: ${i}`)}return!0},updateFromDOM(e,t,i){const r=e.getAttribute("data-pac-update-mode")||this.config.updateMode,n=parseInt(e.getAttribute("data-pac-update-delay"))||this.config.delay;if("immediate"!==r){if("delayed"===r){const r=`${t}_${e.id||e.getAttribute("data-pac-property")}`;this.delays.has(r)&&clearTimeout(this.delays.get(r));const s=setTimeout((()=>{this.abstraction[t]=i,this.delays.delete(r)}),n);this.delays.set(r,s)}}else this.abstraction[t]=i},establishHierarchy(){const{parent:e,children:t}=window.PACRegistry.getHierarchy(this.container);e&&this.parent!==e&&(this.parent=e,e.children.add(this),this.refreshChildDependentComputed(e)),t.forEach((e=>{e.parent!==this&&(e.parent&&e.parent.children.delete(e),e.parent=this,this.children.add(e))})),this.refreshChildDependentComputed(this)},refreshChildDependentComputed(e){e.orig.computed&&Object.keys(e.orig.computed).forEach((t=>{const i=e.orig.computed[t];if("function"==typeof i){const r=i.toString();/this\.children|this\.findChild|Array\.from\(this\.children\)/.test(r)&&(e.computedCache.delete(t),e.updateDOM(t,e.abstraction[t]))}}))},notifyParent(e,t){this.parent&&"function"==typeof this.parent.receiveUpdate&&this.parent.receiveUpdate(e,t,this)},receiveUpdate(e,t,i){this.abstraction.onChildUpdate&&this.abstraction.onChildUpdate(e,t,i),this.container.dispatchEvent(new CustomEvent("pac:childupdate",{detail:{eventType:e,data:t,childPAC:i},bubbles:!0})),this.refreshChildDependentComputed(this)},receiveFromParent(e,t){this.abstraction.receiveFromParent&&this.abstraction.receiveFromParent(e,t),this.container.dispatchEvent(new CustomEvent("pac:parentcommand",{detail:{command:e,data:t},bubbles:!0}))},sendToChildren(e,t){this.children.forEach((i=>{"function"==typeof i.receiveFromParent&&i.receiveFromParent(e,t)}))},initialUpdate(){Object.keys(this.abstraction).forEach((e=>{this.abstraction.hasOwnProperty(e)&&"function"!=typeof this.abstraction[e]&&this.updateDOM(e,this.abstraction[e])})),this.orig.computed&&Object.keys(this.orig.computed).forEach((e=>{this.updateDOM(e,this.abstraction[e])})),this.bindings.forEach((e=>{if("foreach"===e.type){e.prev=[];const t=this.abstraction[e.collection];void 0!==t&&this.updateForeach(e,e.collection,t)}}))},destroy(){this.delays.forEach((e=>clearTimeout(e))),this.delays.clear(),this.listeners.forEach(((e,t)=>{try{"function"==typeof e?this.container.removeEventListener(t,e):this.container.removeEventListener(t,e.handler,e.options)}catch(e){console.warn(`Failed to remove event listener for ${t}:`,e)}})),this.cleanupHierarchy(),this.abstraction=null,this.container=null,this.parent=null},cleanupHierarchy(){this.parent&&(this.parent.children.delete(this),this.parent=null),this.children.forEach((e=>{e.parent=null})),this.children.clear()},init(){return this.setupBindings(),this.trackPropertyPathDependencies(),this.abstraction=this.createReactiveAbs(),this.setupEvents(),this.initialUpdate(),this},trackPropertyPathDependencies(){this.bindings.forEach((e=>{if("text"===e.type&&e.propertyPath){const t=this.splitPath(e.propertyPath);for(let i=0;i<t.length;i++){const i=t[0];this.propDeps.has(i)||this.propDeps.set(i,[]);const r=this.propDeps.get(i);r.includes(e)||r.push(e)}}}))}};const c=function(e,t){const i={};return Object.assign(i,{addChild:e=>{t.children.add(e),e.parent=t},removeChild:e=>{t.children.delete(e),e.parent=null},notifyParent:(e,i)=>t.notifyParent(e,i),receiveUpdate:(e,i,r)=>t.receiveUpdate(e,i,r),receiveFromParent:(e,i)=>t.receiveFromParent(e,i),sendToChildren:(e,i)=>t.sendToChildren(e,i),sendToChild:(e,i,r)=>{const n=Array.from(t.children).find((t=>t.container.matches(e)));n&&n.receiveFromParent&&n.receiveFromParent(i,r)},findChild:e=>Array.from(t.children).find(e),findChildren:e=>Array.from(t.children).filter(e),findChildBySelector:e=>Array.from(t.children).find((t=>t.container.matches(e))),findChildByProperty:(e,i)=>Array.from(t.children).find((t=>t.abstraction&&t.abstraction[e]===i)),control:(e,i={})=>fetch(e,{method:i.method||"GET",headers:Object.assign({"Content-Type":"application/json","X-PAC-Request":"true"},i.headers||{}),body:i.data?JSON.stringify(i.data):void 0}).then((e=>e.json())).then((e=>(i.onSuccess&&i.onSuccess.call(t.abstraction,e),e))).catch((e=>{throw i.onError&&i.onError.call(t.abstraction,e),e})),destroy:()=>t.destroy()}),Object.entries(Object.getOwnPropertyDescriptors(e.abstraction)).forEach((([e,t])=>{"function"==typeof t.value?i.hasOwnProperty(e)||(i[e]=t.value.bind(i)):t.get||t.set?Object.defineProperty(i,e,{...t,get:t.get,set:t.set}):i[e]=t.value})),Object.defineProperties(i,{parent:{get:()=>t.parent,enumerable:!0},children:{get:()=>Array.from(t.children),enumerable:!0},container:{get:()=>t.container,enumerable:!0}}),i}(o.init(),o);return window.PACRegistry.register(t,o),o.establishHierarchy(),window.PACRegistry.units.forEach((e=>{e===o||e.parent||e.establishHierarchy()})),c}t.prototype={register(e,t){this.units.set(e,t),this.cache=new WeakMap},unregister(e){const t=this.units.get(e);return t&&(this.units.delete(e),this.cache=new WeakMap),t},getHierarchy(e){if(this.cache.has(e))return this.cache.get(e);let t=null,i=e.parentElement;const r=[];for(;i&&!t;)this.units.forEach((e=>{e.container===i&&(t=e)})),i=i.parentElement;this.units.forEach((t=>{e.contains(t.container)&&t.container!==e&&r.push(t)}));const n={parent:t,children:r};return this.cache.set(e,n),n}},window.PACRegistry=window.PACRegistry||new t,window.wakaPAC=r,"undefined"!=typeof module&&module.exports&&(module.exports={wakaPAC:r,PACRegistry:t,ReactiveUtils:e})}();